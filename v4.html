<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>Osaka 5-Day Strategy Â· Slow Travel Journal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;500;600&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-body: #f4f1ea;
      --bg-card: #fdfaf6;
      --bg-hero: #efece5;
      --bg-chip: #fffbf5;
      --ink-main: #332c26;
      --ink-muted: #7d7266;
      --ink-soft: #a89c8e;
      --ink-accent: #a67c52;
      --border-soft: #e6ded5;
      --border-strong: #cbbba8;
      --accent: #b08d55;
      --accent-soft: rgba(176, 141, 85, 0.12);
      --shadow-soft: 0 10px 30px rgba(66, 56, 46, 0.08);
      --radius-card: 16px;
    }

    * { box-sizing: border-box; }

    html, body {
      margin: 0;
      padding: 0;
      background: var(--bg-body);
      font-family: "Noto Serif TC", system-ui, -apple-system, BlinkMacSystemFont,
        "Segoe UI", sans-serif;
      color: var(--ink-main);
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
    }

    body {
      min-height: 100vh;
      padding: 14px 10px 90px;
    }

    @media (min-width: 768px) {
      body {
        display: flex;
        justify-content: center;
        padding: 32px 20px 110px;
      }
    }

    .app-shell {
      width: 100%;
      max-width: 900px;
      margin: 0 auto;
      background: var(--bg-card);
      border-radius: 20px;
      border: 1px solid rgba(166, 124, 82, 0.2);
      box-shadow: var(--shadow-soft);
      padding: 20px 16px 96px;
      position: relative;
      overflow: hidden;
    }

    @media (min-width: 768px) {
      .app-shell { padding: 32px 32px 110px; }
    }

    /* Texture Overlay */
    .app-shell::before {
      content: "";
      position: absolute;
      inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%239C92AC' fill-opacity='0.03'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' /%3E%3C/g%3E%3C/svg%3E");
      pointer-events: none;
      z-index: 0;
    }

    .app-inner { position: relative; z-index: 1; }

    /* EDIT BUTTON */
    .edit-toggle {
      position: absolute;
      top: 18px;
      right: 18px;
      z-index: 50;
      background: rgba(255, 255, 255, 0.6);
      border: 1px solid var(--border-strong);
      padding: 4px 12px;
      border-radius: 99px;
      font-family: "Noto Serif TC", serif;
      font-size: 0.75rem;
      color: var(--ink-muted);
      cursor: pointer;
      transition: all 0.2s ease;
      letter-spacing: 0.05em;
    }
    .edit-toggle.active {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }

    [contenteditable="true"] {
      outline: 1px dashed var(--accent);
      outline-offset: 2px;
      background: rgba(255, 255, 255, 0.5);
    }

    .eyebrow {
      font-size: 0.75rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: var(--ink-soft);
      font-family: system-ui, sans-serif;
      font-weight: 500;
    }

    h1, h2, h3, h4 { margin: 0; font-weight: 600; letter-spacing: 0.02em; }
    p { margin: 0 0 0.8em; line-height: 1.75; font-size: 0.95rem; color: var(--ink-main); }

    /* HERO */
    .hero {
      background: var(--bg-hero);
      border-radius: 18px;
      padding: 24px 20px;
      margin-bottom: 24px;
      position: relative;
    }

    .hero-grid {
      display: grid;
      grid-template-columns: minmax(0, 1.6fr) minmax(0, 1fr);
      gap: 24px;
    }
    @media (max-width: 700px) { .hero-grid { grid-template-columns: 1fr; } }

    .hero-title { font-size: 1.6rem; margin-top: 8px; color: var(--ink-main); }
    .hero-subtitle { font-size: 0.92rem; color: var(--ink-muted); margin-top: 8px; line-height: 1.6; }

    .hero-meta-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: 16px;
      align-items: center;
      font-size: 0.85rem;
      color: var(--ink-muted);
      font-family: system-ui, sans-serif;
    }
    .meta-item { display: inline-flex; align-items: center; gap: 6px; }

    .pill {
      display: inline-flex; align-items: center; gap: 6px;
      padding: 4px 12px;
      border-radius: 999px;
      background: #fff;
      border: 1px solid rgba(0,0,0,0.05);
      font-size: 0.75rem;
      color: var(--ink-muted);
      font-family: system-ui, sans-serif;
      box-shadow: 0 1px 2px rgba(0,0,0,0.03);
    }
    .pill-icon { width: 6px; height: 6px; border-radius: 50%; background: var(--accent); }

    /* Hero Secondary Card (Strategy) */
    .hero-secondary {
      background: #2c241b;
      border-radius: 14px;
      padding: 16px;
      color: #eaddcf;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      box-shadow: 0 10px 20px rgba(44, 36, 27, 0.25);
    }
    .hero-secondary h3 { font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.15em; color: #bcaaa4; margin-bottom: 8px; font-family: system-ui, sans-serif; }
    .hero-secondary p { color: rgba(234, 221, 207, 0.9); font-size: 0.88rem; margin-bottom: 12px; line-height: 1.6; }

    .tags { display: flex; flex-wrap: wrap; gap: 6px; }
    .tag {
      padding: 3px 8px;
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 4px;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: rgba(255,255,255,0.8);
      font-family: system-ui, sans-serif;
    }

    /* TIMELINE */
    .timeline { margin-top: 10px; padding-left: 10px; }
    .timeline-item { display: grid; grid-template-columns: 60px 1fr; gap: 16px; padding-bottom: 24px; position: relative; }

    .timeline-time {
      text-align: right;
      font-size: 0.85rem;
      color: var(--ink-muted);
      font-family: system-ui, sans-serif;
      padding-top: 2px;
      position: relative;
    }

    .timeline-line {
      position: absolute;
      top: 24px;
      right: -8px;
      bottom: -16px;
      width: 1px;
      background: rgba(166, 124, 82, 0.3);
      z-index: 0;
    }
    .timeline-item:last-child .timeline-line { display: none; }

    .timeline-dot {
      position: absolute;
      top: 6px;
      right: -12px;
      width: 9px;
      height: 9px;
      border-radius: 50%;
      background: #fff;
      border: 2px solid var(--accent);
      z-index: 1;
    }

    .timeline-card {
      background: #fff;
      border: 1px solid var(--border-soft);
      border-radius: 12px;
      padding: 14px 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.02);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .timeline-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.06);
      border-color: var(--border-strong);
    }

    .timeline-header { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 6px; }
    .timeline-title { font-size: 1rem; color: var(--ink-main); font-weight: 600; }
    .timeline-type { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--ink-soft); font-family: system-ui, sans-serif; }

    .timeline-location { font-size: 0.8rem; color: var(--ink-muted); margin-bottom: 8px; display: flex; align-items: center; gap: 4px; }
    .timeline-location a { color: var(--ink-accent); text-decoration: none; border-bottom: 1px dashed transparent; }
    .timeline-location a:hover { border-bottom-color: var(--ink-accent); }

    .timeline-body { font-size: 0.9rem; color: var(--ink-main); line-height: 1.6; }

    .keyword-link {
      color: var(--ink-accent);
      font-weight: 500;
      cursor: pointer;
      border-bottom: 1px dotted var(--ink-accent);
      transition: all 0.2s;
    }
    .keyword-link:hover { background: var(--accent-soft); }

    /* PHOTO BREAK */
    .photo-break {
      margin: 24px 0 10px;
      background: #fff;
      border: 1px solid var(--border-soft);
      border-radius: 12px;
      overflow: hidden;
      display: grid;
      grid-template-columns: 1fr;
    }
    @media(min-width: 600px) { .photo-break { grid-template-columns: 1.2fr 1fr; } }

    .photo-wrapper {
      position: relative;
      min-height: 240px;
      background: #eee;
      overflow: hidden;
    }

    .photo-img-element {
      width: 100%;
      height: 100%;
      object-fit: cover;
      position: absolute;
      inset: 0;
      transition: opacity 0.5s ease;
    }

    .photo-content { padding: 20px; display: flex; flex-direction: column; justify-content: center; }

    /* BOTTOM NAV */
    .bottom-nav {
      position: fixed; bottom: 0; left: 0; right: 0;
      background: rgba(253, 250, 246, 0.95);
      border-top: 1px solid var(--border-soft);
      backdrop-filter: blur(12px);
      padding: 10px 16px calc(10px + env(safe-area-inset-bottom));
      z-index: 100;
      display: flex; justify-content: center;
    }

    .nav-scroll {
      display: flex; gap: 8px; overflow-x: auto;
      padding-bottom: 4px; max-width: 100%;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }
    .nav-scroll::-webkit-scrollbar { display: none; }

    .nav-btn {
      flex: 0 0 auto;
      padding: 8px 14px;
      border-radius: 99px;
      background: transparent;
      border: 1px solid var(--border-strong);
      color: var(--ink-muted);
      font-size: 0.75rem;
      font-weight: 500;
      letter-spacing: 0.05em;
      cursor: pointer;
      transition: all 0.2s;
      display: flex; align-items: center; gap: 6px;
      font-family: system-ui, sans-serif;
    }
    .nav-btn span { display: block; }
    .nav-btn-dot { width: 6px; height: 6px; border-radius: 50%; background: transparent; border: 1px solid var(--ink-muted); }

    .nav-btn.active { background: var(--ink-main); color: #fff; border-color: var(--ink-main); }
    .nav-btn.active .nav-btn-dot { background: var(--accent); border-color: var(--accent); }

    .nav-btn.special { border-color: var(--accent); color: var(--ink-accent); }
    .nav-btn.special.active { background: var(--accent); color: #fff; }

    /* DRAWER & MODAL */
    .backdrop {
      position: fixed; inset: 0; background: rgba(30,25,20,0.4);
      z-index: 150; opacity: 0; pointer-events: none; transition: opacity 0.3s;
    }
    .backdrop.active { opacity: 1; pointer-events: auto; }

    .drawer {
      position: fixed; bottom: 0; left: 0; right: 0;
      background: #fdfaf6;
      border-radius: 20px 20px 0 0;
      max-height: 85vh;
      transform: translateY(105%);
      transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
      z-index: 160;
      display: flex; flex-direction: column;
      box-shadow: 0 -10px 40px rgba(0,0,0,0.2);
    }
    .drawer.active { transform: translateY(0); }

    .drawer-header {
      padding: 16px 20px;
      border-bottom: 1px solid var(--border-soft);
      display: flex; justify-content: space-between; align-items: center;
      background: rgba(253, 250, 246, 0.95);
      border-radius: 20px 20px 0 0;
    }
    .drawer-title { font-size: 1rem; font-weight: 600; color: var(--ink-main); }
    .drawer-close { background: none; border: none; font-size: 1.5rem; color: var(--ink-muted); cursor: pointer; padding: 0 8px; }

    .drawer-content { padding: 20px; overflow-y: auto; }

    .strategy-card {
      background: #fff;
      border: 1px solid var(--border-soft);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
    }
    .strategy-card h3 { font-size: 0.85rem; color: var(--ink-accent); text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: 10px; font-family: system-ui, sans-serif; }
    .strategy-card p { font-size: 0.9rem; margin-bottom: 8px; }
    .strategy-list li { margin-bottom: 6px; font-size: 0.9rem; color: var(--ink-muted); }

    /* Modal for details */
    .modal {
      position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.95);
      width: 90%; max-width: 420px;
      background: #fff;
      border-radius: 16px;
      padding: 24px;
      z-index: 170;
      opacity: 0; pointer-events: none;
      transition: all 0.2s;
      box-shadow: 0 20px 60px rgba(0,0,0,0.2);
    }
    .backdrop.active .modal { opacity: 1; pointer-events: auto; transform: translate(-50%, -50%) scale(1); }
    .modal-h { font-size: 1.1rem; margin-bottom: 4px; }
    .modal-sub { font-size: 0.75rem; text-transform: uppercase; color: var(--ink-soft); letter-spacing: 0.1em; margin-bottom: 16px; }
    .modal-body { font-size: 0.92rem; color: var(--ink-muted); line-height: 1.7; }
  </style>
</head>

<body>
  <div class="app-shell">
    <button id="edit-toggle" class="edit-toggle">âœ EDIT</button>

    <div class="app-inner">
      <!-- Hero Section -->
      <header class="hero">
        <div class="hero-grid">
          <div>
            <div class="eyebrow" id="day-eyebrow">DAY 01 Â· STRATEGY</div>
            <h1 class="hero-title" id="day-title">Arrival & Winter Gear</h1>
            <p class="hero-subtitle" id="day-subtitle">å¾å·¥ä½œæ¨¡å¼ç™»å‡ºï¼Œå°‡ç¬¬ä¸€å¤©çš„é‡é»æ”¾åœ¨ã€Œå†¬è£è£œé½Šã€èˆ‡ã€Œèª¿æ•´ç¯€å¥ã€ï¼Œè®“å¾ŒçºŒè¡Œç¨‹è¼•é‡åŒ–ã€‚</p>

            <div class="hero-meta-row">
              <div class="pill"><span class="pill-icon"></span><span id="day-date">2025/12/15 Â· Mon</span></div>
              <div class="meta-item">ğŸ“ <span id="day-location">KIX Â· Rinku Town</span></div>
              <div class="meta-item">ğŸŒ¡ï¸ <span id="weather-display">Loading...</span></div>
            </div>
          </div>

          <div class="hero-secondary">
            <div>
              <h3>ä»Šæ—¥ç­–ç•¥ Â· STRATEGY</h3>
              <p id="day-strategy">è‡¨ç©ºåŸæ ¸å¿ƒä»»å‹™ï¼šä¸€æ¬¡è§£æ±ºä¿æš–å¤–å¥—èˆ‡å†¬å­£é…ä»¶ï¼ˆTNF / Beamsï¼‰ï¼Œé¿å…ä¹‹å¾Œå¹¾å¤©ç‚ºäº†è²·è¡£æœåˆ†å¿ƒã€‚</p>
            </div>
            <div class="tags" id="day-tags">
              <span class="tag">WINTER GEAR</span>
              <span class="tag">NO RUSH</span>
            </div>
          </div>
        </div>
      </header>

      <!-- Timeline -->
      <main id="timeline" class="timeline"></main>

      <!-- Photo Break -->
      <div class="photo-break">
        <div class="photo-wrapper" id="photo-wrapper">
          <img id="photo-img-element" class="photo-img-element" src="" alt="Daily Visual" />
        </div>
        <div class="photo-content">
          <div class="eyebrow">VIBE CHECK</div>
          <h3 id="photo-title">Title</h3>
          <p id="photo-desc">Description</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Bottom Navigation -->
  <nav class="bottom-nav">
    <div class="nav-scroll" id="nav-container"></div>
  </nav>

  <!-- Drawer -->
  <div class="backdrop" id="backdrop"></div>
  <div class="drawer" id="drawer">
    <div class="drawer-header">
      <div class="drawer-title">æ—…ç¨‹å°æŠ„ Â· TRIP CHEAT SHEET</div>
      <button class="drawer-close" id="drawer-close">âœ•</button>
    </div>
    <div class="drawer-content">

      <div class="strategy-card">
        <h3>æ ¸å¿ƒåŸå‰‡ Â· CORE PRINCIPLES</h3>
        <p>æ…¢åŠæ‹ Ã— æœ‰ç­–ç•¥çš„åŸå¸‚æ—…è¡Œ</p>
        <ul class="strategy-list" style="padding-left: 20px; margin:0;">
          <li><strong>å†¬è£å…ˆæ±º</strong>ï¼šDay 1 æå®šä¿æš–ï¼Œå¾Œé¢åªé€›ä¸è²·é‡ç‰©ã€‚</li>
          <li><strong>ç¼ºè²¨é¢¨éšªç®¡ç†</strong>ï¼šDay 2 ä¸Šåˆå„ªå…ˆè™•ç†ç†±é–€å½©å¦ã€‚</li>
          <li><strong>å¥ˆè‰¯ç•™ç™½</strong>ï¼šDay 4 ä¸çœ‹åœ°åœ–ï¼Œåªçœ‹é¹¿èˆ‡æ¨¹ã€‚</li>
        </ul>
      </div>

      <div class="strategy-card">
        <h3>ä½å®¿ Â· HOTEL</h3>
        <p><strong>GRANBELL HOTEL OSAKA NAMBA</strong></p>
        <p style="font-size:0.85rem; color:var(--ink-muted);">
          å¤§é˜ªé›£æ³¢æ ¼è˜­è²çˆ¾é…’åº—<br>ã€’556-0011 å¤§é˜ªå¸‚æµªé€Ÿå€é›£æ³¢ä¸­2-6-7
        </p>
      </div>

      <div class="strategy-card">
        <h3>èˆªç­ Â· FLIGHTS (JL)</h3>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
          <div>
            <strong>å»ç¨‹ JL812</strong><br>
            <span style="font-size:0.8rem; color:var(--ink-muted);">08:20 TPE â†’ 11:50 KIX</span>
          </div>
          <div>
            <strong>å›ç¨‹ JL815</strong><br>
            <span style="font-size:0.8rem; color:var(--ink-muted);">19:20 KIX â†’ 21:35 TPE</span>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- Detail Modal -->
  <div class="modal" id="modal">
    <h3 class="modal-h" id="modal-title">Title</h3>
    <div class="modal-sub" id="modal-sub">Subtitle</div>
    <div class="modal-body" id="modal-body">Content</div>
  </div>

<script>
  // =========================
  // SAFE OFFLINE IMAGES (100% no network)
  // =========================
  const SAFE_PHOTOS = {
    day1: makeSafeSvgDataUri({ title: "RINKU",  subtitle: "Arrival Â· Winter Gear",      icon: "ğŸ¡", c1: "#f6d365", c2: "#fda085" }),
    day2: makeSafeSvgDataUri({ title: "UMEDA",  subtitle: "City Strategy Â· Shopping",  icon: "ğŸ™ï¸", c1: "#c3cfe2", c2: "#f5f7fa" }),
    day3: makeSafeSvgDataUri({ title: "CASTLE", subtitle: "Slow Day Â· Winter Sun",     icon: "ğŸ¯", c1: "#dfe9f3", c2: "#ffffff" }),
    day4: makeSafeSvgDataUri({ title: "NARA",   subtitle: "Nature Â· Deer & Trees",     icon: "ğŸ¦Œ", c1: "#dfa579", c2: "#c79081" }),
    day5: makeSafeSvgDataUri({ title: "KIX",    subtitle: "Departure Â· Rituals",       icon: "âœˆï¸", c1: "#a18cd1", c2: "#fbc2eb" }),
  };

  function makeSafeSvgDataUri({ title, subtitle, icon, c1, c2 }) {
    const svg = `
    <svg xmlns="http://www.w3.org/2000/svg" width="1600" height="1000" viewBox="0 0 1600 1000">
      <defs>
        <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stop-color="${c1}"/>
          <stop offset="100%" stop-color="${c2}"/>
        </linearGradient>

        <filter id="noise">
          <feTurbulence type="fractalNoise" baseFrequency="0.7" numOctaves="3" stitchTiles="stitch"/>
          <feColorMatrix type="matrix"
            values="
              1 0 0 0 0
              0 1 0 0 0
              0 0 1 0 0
              0 0 0 0.14 0"/>
        </filter>

        <radialGradient id="glow" cx="30%" cy="25%" r="70%">
          <stop offset="0%" stop-color="#ffffff" stop-opacity="0.55"/>
          <stop offset="60%" stop-color="#ffffff" stop-opacity="0.10"/>
          <stop offset="100%" stop-color="#ffffff" stop-opacity="0"/>
        </radialGradient>
      </defs>

      <rect width="1600" height="1000" fill="url(#g)"/>
      <rect width="1600" height="1000" fill="url(#glow)"/>

      <!-- soft shapes -->
      <circle cx="1220" cy="200" r="180" fill="#ffffff" opacity="0.16"/>
      <circle cx="1320" cy="320" r="120" fill="#ffffff" opacity="0.10"/>
      <path d="M-50,820 C250,720 450,920 700,820 C980,710 1150,930 1650,780 L1650,1050 L-50,1050 Z"
            fill="#1f1a14" opacity="0.12"/>

      <!-- noise overlay -->
      <rect width="1600" height="1000" filter="url(#noise)" opacity="0.9"/>

      <!-- label card -->
      <g transform="translate(90,700)">
        <rect x="0" y="0" width="900" height="220" rx="26" fill="#ffffff" opacity="0.84"/>
        <rect x="0" y="0" width="900" height="220" rx="26" fill="none" stroke="#ffffff" opacity="0.55"/>

        <text x="44" y="78" font-size="66" font-family="system-ui, -apple-system, Segoe UI, sans-serif"
              fill="#2b2117" font-weight="800" letter-spacing="7">${escapeSvgText(title)}</text>

        <text x="44" y="132" font-size="30" font-family="system-ui, -apple-system, Segoe UI, sans-serif"
              fill="#5c5248" letter-spacing="2">${escapeSvgText(subtitle)}</text>

        <text x="820" y="88" font-size="58" font-family="system-ui, -apple-system, Segoe UI, sans-serif"
              fill="#2b2117">${escapeSvgText(icon)}</text>

        <text x="44" y="184" font-size="22" font-family="system-ui, -apple-system, Segoe UI, sans-serif"
              fill="#7d7266">SAFE OFFLINE VISUAL Â· NO NETWORK REQUIRED</text>
      </g>
    </svg>`.trim();

    return "data:image/svg+xml;charset=utf-8," + encodeURIComponent(svg);
  }

  function escapeSvgText(s) {
    return String(s)
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;");
  }

  // =========================
  // DATA MODEL
  // =========================
  const itinerary = [
    {
      id: 0,
      label: "DAY 01",
      date: "2025/12/15 Â· Mon",
      location: "KIX Â· Rinku Town",
      eyebrow: "DAY 01 Â· ARRIVAL",
      title: "Arrival & Winter Gear",
      subtitle: "æŠµé”èˆ‡å†¬è£è£œé½Šï¼šå¾å·¥ä½œæ¨¡å¼ç™»å‡ºï¼Œå°‡é‡é»æ”¾åœ¨ã€Œèª¿æ•´ç¯€å¥ã€ã€‚",
      strategy: "æ ¸å¿ƒä»»å‹™ï¼šåœ¨è‡¨ç©ºåŸä¸€æ¬¡è§£æ±ºä¿æš–å¤–å¥—ï¼ˆTNF / Patagoniaï¼‰èˆ‡é…ä»¶ï¼Œé¿å…å¾ŒçºŒè¡Œç¨‹ç‚ºäº†è²·è¡£æœè€Œä¸­æ–·ã€‚",
      tags: ["WINTER GEAR", "RINKU OUTLET", "SLOW START"],
      weatherCity: "Osaka",
      photo: {
        src: SAFE_PHOTOS.day1,
        title: "è‡¨ç©ºåŸçš„æ—¥è½ï¼ˆé›¢ç·šè¦–è¦ºï¼‰",
        desc: "ä¸ä¾è³´ç¶²è·¯çš„å®‰å…¨åœ–ç‰‡ï¼šä»»ä½•ç’°å¢ƒéƒ½èƒ½é¡¯ç¤ºã€‚"
      },
      timeline: [
        { time: "11:50", type: "ARRIVAL", title: "æŠµé”é—œè¥¿æ©Ÿå ´ (JL812)", location: "KIX T1", desc: "ä¸‹æ©Ÿå¾Œä¸æ€¥è‘—é€²å¸‚å€ã€‚å…ˆåœ¨æ©Ÿå ´æ„Ÿå—ä¸€ä¸‹æº«åº¦ï¼Œç¢ºèª ICOCA å¡èˆ‡ç¶²è·¯ç‹€æ…‹ã€‚" },
        { time: "13:30", type: "LUNCH", title: "Rinku Town åˆé¤", location: "Seaside Area", desc: "æ­ä¸€ç«™é›»è»Šåˆ° Rinku Townï¼Œåœ¨æµ·é‚Šé¤å»³ç°¡å–®ç”¨é¤ï¼Œçœ‹çœ‹æµ·ï¼Œè®“èº«é«”åˆ‡æ›æ™‚å€ã€‚" },
        { time: "15:00", type: "SHOPPING", title: "å†¬è£æˆ°ç•¥æ¡è³¼", location: "Rinku Premium Outlets",
          desc: "ç›®æ¨™æ˜ç¢ºï¼šä¿æš–å¤–å¥—ã€ç™¼ç†±è¡£ã€åœå·¾ã€‚<br>å„ªå…ˆé †åºï¼š<br>1. <strong>The North Face / Patagonia</strong> (ä¿æš–å±¤)<br>2. <strong>BEAMS / United Arrows</strong> (è³ªæ„Ÿå¤§è¡£)<br>3. <strong>Skechers / Nike</strong> (å¥½èµ°çš„é‹)",
          keywords: ["TNF", "BEAMS"]
        },
        { time: "18:30", type: "MOVE", title: "å‰å¾€é›£æ³¢é£¯åº—", location: "Granbell Hotel Namba", desc: "æ­ä¹˜å—æµ·é›»éµé€²å¸‚å€ï¼ŒCheck-in æ”¾ç½®æˆ°åˆ©å“ï¼Œå»ºç«‹é€™äº”å¤©çš„åŸºåœ°ã€‚" },
        { time: "20:00", type: "DINNER", title: "è‡ªç”±è»’ é›£æ³¢æœ¬åº—", location: "Namba", desc: "ç°¡å–®åƒä¸€ä»½åç‰©å’–å“©ï¼Œæ—©é»å›é£¯åº—ä¼‘æ¯ï¼Œæ•´ç†æ˜æ—¥æˆ°ç•¥ã€‚" }
      ]
    },
    {
      id: 1,
      label: "DAY 02",
      date: "2025/12/16 Â· Tue",
      location: "Umeda Â· Kitahama",
      eyebrow: "DAY 02 Â· CITY STRATEGY",
      title: "Strategic Shopping & City Vibe",
      subtitle: "å…ˆè§£æ±ºæ¸…å–®ï¼Œå†æ…¢æ…¢èµ°ï¼šä¸Šåˆè™•ç†ç¼ºè²¨é¢¨éšªé«˜çš„å“é …ï¼Œä¸‹åˆç•™çµ¦æ²³å²¸èˆ‡å’–å•¡ã€‚",
      strategy: "ä¸Šåˆç²¾ç¥æœ€å¥½æ™‚å»æ¢…ç”°è™•ç†å°ˆæ«ƒèˆ‡ç†±é–€å½©å¦ï¼ˆExcel/Canmakeï¼‰ï¼Œä¸‹åˆå‰‡å®Œå…¨æ”¾é¬†ï¼Œä¸èƒŒè³¼ç‰©è¢‹é€›è¡—ã€‚",
      tags: ["SCARCITY SHOPPING", "KITAHAMA CAFE", "RIVER WALK"],
      weatherCity: "Osaka",
      photo: {
        src: SAFE_PHOTOS.day2,
        title: "åŒ—æ¿±çš„å¯§éœï¼ˆé›¢ç·šè¦–è¦ºï¼‰",
        desc: "ä¸€å¼µã€Œä¸æœƒå£ã€çš„åœ–ç‰‡ï¼šå–®æª”é›¢ç·šä¹Ÿèƒ½ä¿ç•™æ°›åœã€‚"
      },
      timeline: [
        { time: "10:00", type: "SHOPPING", title: "æ¢…ç”°æˆ°ç•¥è³¼ç‰©", location: "LUCUA / Grand Front",
          desc: "é–å®šç¼ºè²¨é«˜é¢¨éšªå€ï¼š<br>â€¢ <strong>@cosme OSAKA</strong>: Excel (GB08), Canmake ç«æ¯›è†<br>â€¢ <strong>ç™¾è²¨å°ˆæ«ƒ</strong>: CPB / DIOR (è¶å…‰ç·šå¥½è©¦è‰²)<br>â€¢ <strong>3COINS</strong>: è¯åå•†å“çœ‹åˆ°å°±è²·",
          keywords: ["EXCEL", "CANMAKE", "CPB"]
        },
        { time: "13:30", type: "CHILL", title: "åŒ—æ¿±æ²³ç•”å’–å•¡", location: "Kitahama", desc: "è³¼ç‰©çµæŸï¼Œæ­è»Šåˆ°åŒ—æ¿±ã€‚é¸æ“‡ <strong>Gokan äº”æ„Ÿæœ¬é¤¨</strong> æˆ– <strong>&ISLAND</strong>ï¼Œçœ‹è‘—æ²³å·ç™¼å‘†ã€‚" },
        { time: "15:30", type: "WALK", title: "ä¸­å´ç”ºæ•£æ­¥", location: "Nakazakicho", desc: "åœ¨è€å±‹æ”¹å»ºçš„å°åº—é–“ç©¿æ¢­ã€‚é‡é»åº—å®¶ï¼š<strong>neel</strong> (å¯éº—é¤…)ã€<strong>OSA COFFEE</strong> (å¸ƒä¸)ã€‚åªçœ‹ä¸è²·ä¹Ÿç„¡æ‰€è¬‚ã€‚" },
        { time: "18:30", type: "DINNER", title: "é“é “å €ç¶“å…¸", location: "Dotonbori", desc: "å›åˆ°ç†±é¬§çš„é›£æ³¢ã€‚æ™šé¤é¸æ“‡ <strong>å‘³ä¹ƒå®¶ (å¤§é˜ªç‡’)</strong> æˆ–éš¨æ„è²· <strong>Kukuru ç« é­šç‡’</strong> å›é£¯åº—åƒã€‚" }
      ]
    },
    {
      id: 2,
      label: "DAY 03",
      date: "2025/12/17 Â· Wed",
      location: "Osaka Castle Park",
      eyebrow: "DAY 03 Â· SLOW DAY",
      title: "Castle Park & Winter Sun",
      subtitle: "æŠŠæ™‚é–“æ‹‰é•·ï¼šä¸æ€¥è‘—é€²å¤©å®ˆé–£ï¼Œé‡é»æ˜¯å…¬åœ’æœ¬èº«çš„æ¨¹å½±èˆ‡è­·åŸæ²³ã€‚",
      strategy: "ä»Šæ—¥æ˜¯é«”åŠ›èª¿ç¯€æ—¥ã€‚å¦‚æœæ˜¨å¤©é‚„æœ‰æœªè²·é½Šçš„é«˜å–®åƒ¹å“ï¼ˆCPB/DIORï¼‰ï¼Œä¸‹åˆå¯ä½œç‚ºå‚™æ¡ˆæ™‚é–“ã€‚",
      tags: ["OSAKA CASTLE", "JO-TERRACE", "RELAX"],
      weatherCity: "Osaka",
      photo: {
        src: SAFE_PHOTOS.day3,
        title: "è­·åŸæ²³çš„å€’å½±ï¼ˆé›¢ç·šè¦–è¦ºï¼‰",
        desc: "è¦–è¦ºç”¨é€”ï¼šæŠŠç¯€å¥æ‹‰æ…¢ï¼Œæé†’ä»Šå¤©ä¸éœ€è¦å¡æ»¿ã€‚"
      },
      timeline: [
        { time: "10:00", type: "WALK", title: "å¤§é˜ªåŸå…¬åœ’æ•£æ­¥", location: "Osaka Castle Park", desc: "å¾æ£®ä¹‹å®®ç«™é€²å…¥ï¼Œæ²¿è‘—å¤–åœæ…¢æ…¢èµ°ã€‚ä¸ç”¨å¼·æ±‚ç™»ä¸Šå¤©å®ˆé–£ï¼Œæ‰¾å¼µé•·æ¤…æ›¬å†¬å¤©çš„å¤ªé™½ã€‚" },
        { time: "12:30", type: "LUNCH", title: "Jo-Terrace Osaka", location: "Osakajokoen Station", desc: "å…¬åœ’æ—çš„è¤‡åˆè¨­æ–½ï¼Œé¸æ“‡å¤šä¸”ç’°å¢ƒèˆ’é©ã€‚é¿é–‹éŠå®¢åœ˜é¤æ™‚æ®µã€‚" },
        { time: "15:00", type: "BUFFER", title: "å¸‚å€å‚™æ¡ˆ / ä¼‘æ¯", location: "City Center", desc: "å¦‚æœæ˜¨å¤©æ¢…ç”°æ²’è²·é½Šï¼Œé€™æ®µæ™‚é–“å¯å»å¿ƒé½‹æ©‹å¤§ä¸¸è£œè²¨ã€‚å¦‚æœç´¯äº†ï¼Œå°±å›é£¯åº—åˆç¡ã€‚" },
        { time: "18:30", type: "DINNER", title: "ç¦å¤ªéƒ å¤§é˜ªç‡’", location: "Namba", desc: "æœ¬åº—æ°›åœæ¥µä½³ï¼Œè”¥ç‡’æ˜¯å¿…é»ã€‚å¯èƒ½éœ€è¦æ’éšŠï¼Œå»ºè­°é¿é–‹å°–å³°æˆ–åšå¥½ç­‰å¾…å¿ƒç†æº–å‚™ã€‚" }
      ]
    },
    {
      id: 3,
      label: "DAY 04",
      date: "2025/12/18 Â· Thu",
      location: "Nara",
      eyebrow: "DAY 04 Â· NATURE",
      title: "Nara Day Trip",
      subtitle: "é¹¿èˆ‡æ¨¹çš„ä¸€å¤©ï¼šæŠŠè³¼ç‰©æ…¾æœ›é™åˆ°æœ€ä½ï¼Œåªå¸¶ç›¸æ©Ÿèˆ‡å¥½èµ°çš„å¿ƒæƒ…ã€‚",
      strategy: "å¥ˆè‰¯ä¸æ˜¯æ‰“å¡æ¸…å–®ï¼Œè€Œæ˜¯ä¸€å€‹è®“æ™‚é–“è®Šæ…¢çš„åœ°æ–¹ã€‚ä¸è³¼ç‰©ã€ä¸è¶•è·¯ï¼Œé †è‘—é¹¿çš„æ­¥èª¿èµ°ã€‚",
      tags: ["DEER", "OLD TOWN", "NO SHOPPING"],
      weatherCity: "Nara",
      photo: {
        src: SAFE_PHOTOS.day4,
        title: "å¤éƒ½çš„çœ¼ç¥ï¼ˆé›¢ç·šè¦–è¦ºï¼‰",
        desc: "å®‰å…¨åœ–ç‰‡ï¼šä»»ä½•ç’°å¢ƒé–‹å•Ÿéƒ½ä¸æœƒç¼ºåœ–ã€‚"
      },
      timeline: [
        { time: "09:30", type: "TRAIN", title: "å‰å¾€å¥ˆè‰¯", location: "Kintetsu Nara", desc: "æ­ä¹˜è¿‘éµå‰å¾€å¥ˆè‰¯ã€‚é€™æ®µè»Šç¨‹ç´„ 40 åˆ†é˜ï¼Œæ˜¯è½‰æ›å¿ƒæƒ…çš„éš§é“ã€‚" },
        { time: "10:30", type: "COFFEE", title: "Rokumei Coffee", location: "Nara", desc: "æŠµé”å¾Œå…ˆä¾†ä¸€æ¯å† è»å’–å•¡ã€‚Rokumei Coffee å¥ˆè‰¯æœ¬åº—ï¼Œå¸¶èµ°æˆ–å…§ç”¨éƒ½å¥½ã€‚" },
        { time: "12:00", type: "LUNCH", title: "å¿—æ´¥é¦™ é‡œé£¯", location: "Nara Park Area", desc: "è‘—åçš„é‡œé£¯ï¼Œç±³é£¯é¦™æ°£è¿·äººã€‚è‹¥æ’éšŠå¤ªé•·ï¼Œè½‰å¾€å¥ˆè‰¯ç”ºæ‰¾å®šé£Ÿä¹Ÿä¸éŒ¯ã€‚" },
        { time: "14:00", type: "WALK", title: "å¥ˆè‰¯å…¬åœ’ & è€è¡—", location: "Naramachi", desc: "é¿é–‹æ±å¤§å¯ºäººæ½®æœ€æ“æ“ è™•ï¼Œå¾€æ˜¥æ—¥å¤§ç¤¾åƒé“æˆ–å¥ˆè‰¯ç”ºè€è¡—èµ°ã€‚æ‰¾é–“å’Œè“å­åº—ååã€‚" },
        { time: "17:30", type: "RETURN", title: "è¿”å›å¤§é˜ª", location: "Namba", desc: "æ™šé¤éš¨æ„è§£æ±ºï¼Œæˆ–è¨±æ˜¯å¿ƒé½‹æ©‹çš„å¤©å©¦ç¾…ï¼Œæˆ–æ˜¯ç°¡å–®çš„æ‹‰éºµã€‚ä»Šæ™šæ—©é»ä¼‘æ¯ï¼Œæ•´ç†è¡Œæã€‚" }
      ]
    },
    {
      id: 4,
      label: "DAY 05",
      date: "2025/12/19 Â· Fri",
      location: "Namba Â· KIX",
      eyebrow: "DAY 05 Â· DEPARTURE",
      title: "Departure & Rituals",
      subtitle: "æŠŠæ—…ç¨‹æŠ˜æˆæ›¸ç±¤ï¼šæœ€å¾Œçš„å’–å•¡èˆ‡æœ€å¾Œçš„æ¡è²·ã€‚",
      strategy: "å›ç¨‹æ—¥çš„é‡é»æ˜¯ã€Œä¸éºæ¼ã€èˆ‡ã€Œå„€å¼æ„Ÿã€ã€‚æ©Ÿå ´ç•™çµ¦ Blue Bottle èˆ‡æœ€å¾Œçš„ä¼´æ‰‹ç¦®ã€‚",
      tags: ["BLUE BOTTLE", "LAST BUY", "GOODBYE"],
      weatherCity: "Osaka",
      photo: {
        src: SAFE_PHOTOS.day5,
        title: "é›¢é–‹çš„è¦–è§’ï¼ˆé›¢ç·šè¦–è¦ºï¼‰",
        desc: "é›¢ç·šä¹Ÿèƒ½ä¿ç•™ä¸€å¼µã€Œæ”¶æŸã€ç”¨çš„è¦–è¦ºæ›¸ç±¤ã€‚"
      },
      timeline: [
        { time: "10:00", type: "CHECKOUT", title: "é€€æˆ¿ & å¯„æ”¾è¡Œæ", location: "Granbell Hotel", desc: "11:00 é€€æˆ¿ã€‚å†æª¢æŸ¥ä¸€æ¬¡åºŠåº•èˆ‡æ’åº§ã€‚å»é™„è¿‘çš„è—¥å¦åº—è£œé½Šæœ€å¾Œçš„æ¶ˆè€—å“ï¼ˆéç¼ºè²¨é¡ï¼‰ã€‚" },
        { time: "12:00", type: "LUNCH", title: "æœ€å¾Œçš„å¤§é˜ªå‘³", location: "Namba", desc: "é¸æ“‡ä¸€å®¶é‚„æ²’åƒåˆ°çš„æ¸…å–®ï¼Œæˆ–è€…å–®ç´”åƒå€‹å¾¡é£¯ç³°ï¼ŒæŠŠèƒƒç•™çµ¦é£›æ©Ÿé¤æˆ–æ©Ÿå ´ç¾é£Ÿã€‚" },
        { time: "14:30", type: "MOVE", title: "å‰å¾€é—œè¥¿æ©Ÿå ´", location: "Nankai Line", desc: "æ­ä¹˜ Rapi:t æˆ–ç©ºæ¸¯æ€¥è¡Œå‰å¾€ KIXã€‚é ç•™å……è£•æ™‚é–“ã€‚" },
        { time: "16:00", type: "LAST STOP", title: "æ©Ÿå ´å„€å¼", location: "KIX Airside", desc: "1. <strong>Blue Bottle Coffee KIX</strong> å–æœ€å¾Œä¸€æ¯ã€‚<br>2. è³¼è²·é—œè¥¿é™å®šä¼´æ‰‹ç¦®ï¼ˆè³å‘³æœŸé™çŸ­çš„é»å¿ƒï¼‰ã€‚<br>3. æº–å‚™ç™»æ©Ÿ JL815 (19:20)ã€‚" }
      ]
    }
  ];

  const modalDetails = {
    "TNF": "æ¨è–¦å‰å¾€ Rinku Outlet çš„åŒ—é¢å°ˆè³£åº—ï¼Œé€šå¸¸æ¬¾å¼æ¯”å¸‚å€å¤šä¸”æŠ˜æ‰£å¥½ã€‚é‡é»çœ‹ Mountain Light Jacket ç³»åˆ—ã€‚",
    "BEAMS": "Outlet çš„ BEAMS æœ‰å¾ˆå¤šé«˜å“è³ªçš„åŸºæœ¬æ¬¾æ¯›è¡£èˆ‡å¤§è¡£ï¼Œæ€§åƒ¹æ¯”æ¥µé«˜ã€‚",
    "EXCEL": "Excel çœ‰ç­†èˆ‡çœ¼å½± (GB08) åœ¨éŠå®¢å€å¸¸ç¼ºè²¨ï¼Œæ¢…ç”° LUCUA çš„ @cosme è²¨æºç›¸å°å……è¶³ã€‚",
    "CANMAKE": "é‡‘è“‹ç«æ¯›å¾©æ´»æ¶²èˆ‡æ–°è‰²è…®ç´…æ˜¯é‡é»ã€‚",
    "CPB": "è‚Œè†šä¹‹é‘° (ClÃ© de Peau BeautÃ©) åœ¨ç™¾è²¨å°ˆæ«ƒè³¼è²·å¯é€€ç¨…ã€‚å»ºè­°å…ˆçœ‹å¥½è‰²è™Ÿåœ–ç‰‡ç›´æ¥çµ¦æ«ƒå§çœ‹ã€‚"
  };

  // --- APP LOGIC ---
  const state = { activeDay: 0 };

  const els = {
    timeline: document.getElementById('timeline'),
    nav: document.getElementById('nav-container'),
    drawer: document.getElementById('drawer'),
    backdrop: document.getElementById('backdrop'),
    modal: document.getElementById('modal'),

    date: document.getElementById('day-date'),
    location: document.getElementById('day-location'),
    title: document.getElementById('day-title'),
    subtitle: document.getElementById('day-subtitle'),
    strategy: document.getElementById('day-strategy'),
    tags: document.getElementById('day-tags'),
    weather: document.getElementById('weather-display'),
    eyebrow: document.getElementById('day-eyebrow'),

    photoWrapper: document.getElementById('photo-wrapper'),
    photoImgElement: document.getElementById('photo-img-element'),
    photoTitle: document.getElementById('photo-title'),
    photoDesc: document.getElementById('photo-desc'),

    editToggle: document.getElementById('edit-toggle'),
    closeDrawer: document.getElementById('drawer-close')
  };

  function init() {
    renderNav();

    // ç¢ºä¿ä»»ä½•ç’°å¢ƒéƒ½èƒ½é¡¯ç¤ºï¼ˆå…§åµŒåœ–ä¸éœ€è¦ onload/onerrorï¼‰
    loadDay(0);
    fetchWeather(itinerary[0].weatherCity);

    els.editToggle.addEventListener('click', toggleEdit);
    els.backdrop.addEventListener('click', closeAllOverlays);
    els.closeDrawer.addEventListener('click', closeAllOverlays);

    document.addEventListener('click', (e) => {
      if (e.target.classList.contains('keyword-link')) {
        openModal(e.target.innerText, e.target.dataset.key);
      }
    });
  }

  function renderNav() {
    const frag = document.createDocumentFragment();

    itinerary.forEach((day, idx) => {
      const btn = document.createElement('button');
      btn.className = `nav-btn ${idx === 0 ? 'active' : ''}`;
      btn.innerHTML = `<span class="nav-btn-dot"></span><span>${day.label}</span>`;
      btn.onclick = () => loadDay(idx);
      frag.appendChild(btn);
    });

    const tripBtn = document.createElement('button');
    tripBtn.className = 'nav-btn special';
    tripBtn.innerHTML = `<span>TRIP</span>`;
    tripBtn.onclick = openDrawer;
    frag.appendChild(tripBtn);

    els.nav.innerHTML = '';
    els.nav.appendChild(frag);
  }

  function loadDay(idx) {
    state.activeDay = idx;
    const data = itinerary[idx];

    document.querySelectorAll('.nav-btn').forEach((b, i) => {
      if (i < itinerary.length) b.classList.toggle('active', i === idx);
    });

    animateUpdate(els.title, data.title);
    animateUpdate(els.subtitle, data.subtitle);
    els.date.innerText = data.date;
    els.location.innerText = data.location;
    els.eyebrow.innerText = data.eyebrow;
    els.strategy.innerHTML = data.strategy;

    els.tags.innerHTML = data.tags.map(t => `<span class="tag">${t}</span>`).join('');

    // Photo (SAFE OFFLINE)
    els.photoImgElement.style.opacity = 1;
    els.photoImgElement.src = data.photo.src;
    els.photoTitle.innerText = data.photo.title;
    els.photoDesc.innerText = data.photo.desc;

    renderTimeline(data.timeline);

    const prevCity = itinerary[idx > 0 ? idx - 1 : 0].weatherCity;
    if (data.weatherCity !== prevCity || idx === 0) fetchWeather(data.weatherCity);

    window.scrollTo({ top: 0, behavior: 'smooth' });
  }

  function renderTimeline(items) {
    els.timeline.innerHTML = items.map((item) => {
      let desc = item.desc;
      if (item.keywords) {
        item.keywords.forEach(kw => {
          if (modalDetails[kw]) {
            // replace all occurrences safely
            const re = new RegExp(kw.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
            desc = desc.replace(re, `<span class="keyword-link" data-key="${kw}">${kw}</span>`);
          }
        });
      }

      return `
      <div class="timeline-item">
        <div class="timeline-time">
          ${item.time}
          <div class="timeline-dot"></div>
          <div class="timeline-line"></div>
        </div>
        <article class="timeline-card">
          <div class="timeline-header">
            <div class="timeline-title" contenteditable="false">${item.title}</div>
            <div class="timeline-type">${item.type}</div>
          </div>
          <div class="timeline-location">
            ğŸ“ <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.location + ' Osaka')}" target="_blank" rel="noopener">${item.location}</a>
          </div>
          <div class="timeline-body" contenteditable="false">${desc}</div>
        </article>
      </div>
      `;
    }).join('');
  }

  function animateUpdate(el, text) {
    el.style.opacity = 0;
    setTimeout(() => {
      el.innerHTML = text;
      el.style.opacity = 1;
    }, 150);
  }

  function openDrawer() {
    els.backdrop.classList.add('active');
    els.drawer.classList.add('active');
  }

  function closeAllOverlays() {
    els.backdrop.classList.remove('active');
    els.drawer.classList.remove('active');
    els.modal.style.opacity = 0;
    els.modal.style.pointerEvents = 'none';
  }

  function openModal(title, key) {
    const content = modalDetails[key] || "æš«ç„¡è©³ç´°ç­–ç•¥è³‡è¨Šã€‚";
    document.getElementById('modal-title').innerText = title;
    document.getElementById('modal-sub').innerText = "SHOPPING STRATEGY";
    document.getElementById('modal-body').innerText = content;

    els.backdrop.classList.add('active');
    els.modal.style.opacity = 1;
    els.modal.style.pointerEvents = 'auto';
  }

  function toggleEdit() {
    const isEditable = els.editToggle.classList.toggle('active');
    const editables = document.querySelectorAll('[contenteditable]');
    editables.forEach(el => el.setAttribute('contenteditable', isEditable));
    els.editToggle.innerText = isEditable ? 'âœ“ SAVE' : 'âœ EDIT';
  }

  async function fetchWeather(city) {
    els.weather.innerText = "Loading...";
    try {
      // Mock for stability (replace with real API if needed)
      setTimeout(() => {
        const temps = { "Osaka": "8Â°C", "Nara": "6Â°C" };
        els.weather.innerText = temps[city] || "10Â°C";
      }, 350);
    } catch (e) {
      els.weather.innerText = "--";
    }
  }

  init();
</script>
</body>
</html>
