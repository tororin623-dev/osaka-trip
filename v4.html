<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="referrer" content="no-referrer">
  <title>Osaka 5-Day Strategy Â· Slow Travel Journal (v4 rescued)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;500;600&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-body: #f4f1ea;
      --bg-card: #fdfaf6;
      --bg-hero: #efece5;
      --bg-chip: #fffbf5;

      --ink-main: #332c26;
      --ink-muted: #7d7266;
      --ink-soft: #a89c8e;
      --ink-accent: #a67c52;

      --border-soft: #e6ded5;
      --border-strong: #cbbba8;

      --accent: #b08d55;
      --accent-soft: rgba(176, 141, 85, 0.12);

      --shadow-soft: 0 10px 30px rgba(66, 56, 46, 0.08);
      --radius-card: 16px;
    }

    * { box-sizing: border-box; }

    html, body {
      margin: 0;
      padding: 0;
      background: var(--bg-body);
      font-family: "Noto Serif TC", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--ink-main);
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
    }

    body { min-height: 100vh; padding: 14px 10px 90px; }

    @media (min-width: 768px) {
      body { display: flex; justify-content: center; padding: 32px 20px 110px; }
    }

    .app-shell {
      width: 100%;
      max-width: 900px;
      margin: 0 auto;
      background: var(--bg-card);
      border-radius: 20px;
      border: 1px solid rgba(166, 124, 82, 0.2);
      box-shadow: var(--shadow-soft);
      padding: 20px 16px 96px;
      position: relative;
      overflow: hidden;
    }

    @media (min-width: 768px) {
      .app-shell { padding: 32px 32px 110px; }
    }

    /* Subtle global texture */
    .app-shell::before {
      content: "";
      position: absolute;
      inset: 0;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.045'/%3E%3C/svg%3E");
      pointer-events: none;
      z-index: 0;
    }

    .app-inner { position: relative; z-index: 1; }

    /* EDIT BUTTON */
    .edit-toggle {
      position: absolute;
      top: 18px;
      right: 18px;
      z-index: 50;
      background: rgba(255, 255, 255, 0.6);
      border: 1px solid var(--border-strong);
      padding: 4px 12px;
      border-radius: 99px;
      font-family: "Noto Serif TC", serif;
      font-size: 0.75rem;
      color: var(--ink-muted);
      cursor: pointer;
      transition: all 0.2s ease;
      letter-spacing: 0.05em;
      user-select: none;
    }
    .edit-toggle.active {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }

    [contenteditable="true"] {
      outline: 1px dashed var(--accent);
      outline-offset: 2px;
      background: rgba(255, 255, 255, 0.45);
      border-radius: 8px;
      padding: 2px 4px;
    }

    .eyebrow {
      font-size: 0.75rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: var(--ink-soft);
      font-family: system-ui, sans-serif;
      font-weight: 600;
    }

    h1, h2, h3, h4 { margin: 0; font-weight: 600; letter-spacing: 0.02em; }
    p { margin: 0 0 0.8em; line-height: 1.75; font-size: 0.95rem; color: var(--ink-main); }

    /* HERO */
    .hero {
      background: var(--bg-hero);
      border-radius: 18px;
      padding: 24px 20px;
      margin-bottom: 24px;
      position: relative;
    }

    .hero-grid {
      display: grid;
      grid-template-columns: minmax(0, 1.6fr) minmax(0, 1fr);
      gap: 24px;
    }
    @media (max-width: 700px) { .hero-grid { grid-template-columns: 1fr; } }

    .hero-title { font-size: 1.6rem; margin-top: 8px; color: var(--ink-main); }
    .hero-subtitle { font-size: 0.92rem; color: var(--ink-muted); margin-top: 8px; line-height: 1.6; }

    .hero-meta-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-top: 16px;
      align-items: center;
      font-size: 0.85rem;
      color: var(--ink-muted);
      font-family: system-ui, sans-serif;
    }
    .meta-item { display: inline-flex; align-items: center; gap: 6px; }

    .pill {
      display: inline-flex; align-items: center; gap: 6px;
      padding: 4px 12px;
      border-radius: 999px;
      background: #fff;
      border: 1px solid rgba(0,0,0,0.05);
      font-size: 0.75rem;
      color: var(--ink-muted);
      font-family: system-ui, sans-serif;
      box-shadow: 0 1px 2px rgba(0,0,0,0.03);
    }
    .pill-icon { width: 6px; height: 6px; border-radius: 50%; background: var(--accent); }

    /* Hero Secondary */
    .hero-secondary {
      background: #2c241b;
      border-radius: 14px;
      padding: 16px;
      color: #eaddcf;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      box-shadow: 0 10px 20px rgba(44, 36, 27, 0.25);
    }
    .hero-secondary h3 {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: #bcaaa4;
      margin-bottom: 8px;
      font-family: system-ui, sans-serif;
    }
    .hero-secondary p {
      color: rgba(234, 221, 207, 0.9);
      font-size: 0.88rem;
      margin-bottom: 12px;
      line-height: 1.6;
    }
    .tags { display: flex; flex-wrap: wrap; gap: 6px; }
    .tag {
      padding: 3px 8px;
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 4px;
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: rgba(255,255,255,0.8);
      font-family: system-ui, sans-serif;
    }

    /* TIMELINE */
    .timeline { margin-top: 10px; padding-left: 10px; }
    .timeline-item { display: grid; grid-template-columns: 60px 1fr; gap: 16px; padding-bottom: 24px; position: relative; }
    .timeline-time {
      text-align: right;
      font-size: 0.85rem;
      color: var(--ink-muted);
      font-family: system-ui, sans-serif;
      padding-top: 2px;
      position: relative;
    }
    .timeline-line {
      position: absolute;
      top: 24px;
      right: -8px;
      bottom: -16px;
      width: 1px;
      background: rgba(166, 124, 82, 0.3);
      z-index: 0;
    }
    .timeline-item:last-child .timeline-line { display: none; }
    .timeline-dot {
      position: absolute;
      top: 6px;
      right: -12px;
      width: 9px;
      height: 9px;
      border-radius: 50%;
      background: #fff;
      border: 2px solid var(--accent);
      z-index: 1;
    }

    .timeline-card {
      background: #fff;
      border: 1px solid var(--border-soft);
      border-radius: 12px;
      padding: 14px 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.02);
      transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
    }
    .timeline-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.06);
      border-color: var(--border-strong);
    }

    .timeline-header { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 6px; gap: 12px; }
    .timeline-title { font-size: 1rem; color: var(--ink-main); font-weight: 600; }
    .timeline-type { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.1em; color: var(--ink-soft); font-family: system-ui, sans-serif; white-space: nowrap; }

    .timeline-location {
      font-size: 0.8rem;
      color: var(--ink-muted);
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 4px;
    }
    .timeline-location a {
      color: var(--ink-accent);
      text-decoration: none;
      border-bottom: 1px dashed transparent;
    }
    .timeline-location a:hover { border-bottom-color: var(--ink-accent); }

    .timeline-body { font-size: 0.9rem; color: var(--ink-main); line-height: 1.6; }

    .keyword-link {
      color: var(--ink-accent);
      font-weight: 600;
      cursor: pointer;
      border-bottom: 1px dotted var(--ink-accent);
      transition: background 0.2s;
      padding: 0 2px;
      border-radius: 4px;
    }
    .keyword-link:hover { background: var(--accent-soft); }

    /* PHOTO BREAK (Safe visual, no external) */
    .photo-break {
      margin: 24px 0 10px;
      background: #fff;
      border: 1px solid var(--border-soft);
      border-radius: 12px;
      overflow: hidden;
      display: grid;
      grid-template-columns: 1fr;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    @media(min-width: 600px) { .photo-break { grid-template-columns: 1.2fr 1fr; } }

    .photo-wrapper {
      position: relative;
      min-height: 260px;
      overflow: hidden;
      background: radial-gradient(1200px 500px at 30% 20%, rgba(255,255,255,0.35), transparent 55%),
                  linear-gradient(135deg, #d8c7b2 0%, #b7c7d6 60%, #9aa1a8 100%);
    }

    /* subtle overlay film */
    .photo-wrapper::after {
      content: "";
      position: absolute;
      inset: 0;
      background-image: linear-gradient(180deg, rgba(0,0,0,0.06), transparent 30%, rgba(0,0,0,0.08));
      pointer-events: none;
      z-index: 2;
      mix-blend-mode: multiply;
    }

    .photo-img-element {
      width: 100%;
      height: 100%;
      object-fit: cover;
      position: absolute;
      inset: 0;
      z-index: 1;
      opacity: 1;
      transform: scale(1.02);
      filter: contrast(1.02) saturate(1.02);
    }

    .photo-content {
      padding: 24px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      background: rgba(255,255,255,0.82);
      position: relative;
      z-index: 3;
    }

    /* BOTTOM NAV */
    .bottom-nav {
      position: fixed; bottom: 0; left: 0; right: 0;
      background: rgba(253, 250, 246, 0.95);
      border-top: 1px solid var(--border-soft);
      backdrop-filter: blur(12px);
      padding: 10px 16px calc(10px + env(safe-area-inset-bottom));
      z-index: 100;
      display: flex;
      justify-content: center;
    }
    .nav-scroll {
      display: flex; gap: 8px; overflow-x: auto;
      padding-bottom: 4px; max-width: 100%;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }
    .nav-scroll::-webkit-scrollbar { display: none; }

    .nav-btn {
      flex: 0 0 auto;
      padding: 8px 14px;
      border-radius: 99px;
      background: transparent;
      border: 1px solid var(--border-strong);
      color: var(--ink-muted);
      font-size: 0.75rem;
      font-weight: 600;
      letter-spacing: 0.05em;
      cursor: pointer;
      transition: all 0.2s;
      display: flex; align-items: center; gap: 6px;
      font-family: system-ui, sans-serif;
      user-select: none;
    }
    .nav-btn span { display: block; }
    .nav-btn-dot { width: 6px; height: 6px; border-radius: 50%; background: transparent; border: 1px solid var(--ink-muted); }

    .nav-btn.active { background: var(--ink-main); color: #fff; border-color: var(--ink-main); }
    .nav-btn.active .nav-btn-dot { background: var(--accent); border-color: var(--accent); }

    .nav-btn.special { border-color: var(--accent); color: var(--ink-accent); }
    .nav-btn.special.active { background: var(--accent); color: #fff; }

    /* DRAWER & MODAL */
    .backdrop {
      position: fixed; inset: 0; background: rgba(30,25,20,0.4);
      z-index: 150; opacity: 0; pointer-events: none; transition: opacity 0.3s;
    }
    .backdrop.active { opacity: 1; pointer-events: auto; }

    .drawer {
      position: fixed; bottom: 0; left: 0; right: 0;
      background: #fdfaf6;
      border-radius: 20px 20px 0 0;
      max-height: 85vh;
      transform: translateY(105%);
      transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
      z-index: 160;
      display: flex; flex-direction: column;
      box-shadow: 0 -10px 40px rgba(0,0,0,0.2);
    }
    .drawer.active { transform: translateY(0); }

    .drawer-header {
      padding: 16px 20px;
      border-bottom: 1px solid var(--border-soft);
      display: flex; justify-content: space-between; align-items: center;
      background: rgba(253, 250, 246, 0.95);
      border-radius: 20px 20px 0 0;
    }
    .drawer-title { font-size: 1rem; font-weight: 700; color: var(--ink-main); }
    .drawer-close { background: none; border: none; font-size: 1.5rem; color: var(--ink-muted); cursor: pointer; padding: 0 8px; }

    .drawer-content { padding: 20px; overflow-y: auto; }

    .strategy-card {
      background: #fff;
      border: 1px solid var(--border-soft);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
    }
    .strategy-card h3 {
      font-size: 0.85rem;
      color: var(--ink-accent);
      text-transform: uppercase;
      letter-spacing: 0.1em;
      margin-bottom: 10px;
      font-family: system-ui, sans-serif;
    }
    .strategy-card p { font-size: 0.9rem; margin-bottom: 8px; }
    .strategy-list li { margin-bottom: 6px; font-size: 0.9rem; color: var(--ink-muted); }

    .modal {
      position: fixed; top: 50%; left: 50%;
      transform: translate(-50%, -50%) scale(0.97);
      width: 90%; max-width: 420px;
      background: #fff;
      border-radius: 16px;
      padding: 22px;
      z-index: 170;
      opacity: 0; pointer-events: none;
      transition: all 0.2s ease;
      box-shadow: 0 20px 60px rgba(0,0,0,0.2);
    }
    .modal.active {
      opacity: 1; pointer-events: auto;
      transform: translate(-50%, -50%) scale(1);
    }
    .modal-h { font-size: 1.05rem; margin-bottom: 4px; }
    .modal-sub { font-size: 0.75rem; text-transform: uppercase; color: var(--ink-soft); letter-spacing: 0.1em; margin-bottom: 14px; }
    .modal-body { font-size: 0.92rem; color: var(--ink-muted); line-height: 1.7; }

    /* Small motion polish for hero text changes */
    .fade-swap { transition: opacity 180ms ease; }
  </style>
</head>

<body>
  <div class="app-shell">
    <button id="edit-toggle" class="edit-toggle" type="button">âœ EDIT</button>

    <div class="app-inner">
      <header class="hero">
        <div class="hero-grid">
          <div>
            <div class="eyebrow" id="day-eyebrow">DAY 01 Â· STRATEGY</div>
            <h1 class="hero-title fade-swap" id="day-title">Arrival & Winter Gear</h1>
            <p class="hero-subtitle fade-swap" id="day-subtitle">å¾å·¥ä½œæ¨¡å¼ç™»å‡ºï¼Œå°‡ç¬¬ä¸€å¤©çš„é‡é»æ”¾åœ¨ã€Œå†¬è£è£œé½Šã€èˆ‡ã€Œèª¿æ•´ç¯€å¥ã€ï¼Œè®“å¾ŒçºŒè¡Œç¨‹è¼•é‡åŒ–ã€‚</p>

            <div class="hero-meta-row">
              <div class="pill"><span class="pill-icon"></span><span id="day-date">2025/12/15 Â· Mon</span></div>
              <div class="meta-item">ğŸ“ <span id="day-location">KIX Â· Rinku Town</span></div>
              <div class="meta-item">ğŸŒ¡ï¸ <span id="weather-display">Loading...</span></div>
            </div>
          </div>

          <div class="hero-secondary">
            <div>
              <h3>ä»Šæ—¥ç­–ç•¥ Â· STRATEGY</h3>
              <p id="day-strategy">è‡¨ç©ºåŸæ ¸å¿ƒä»»å‹™ï¼šä¸€æ¬¡è§£æ±ºä¿æš–å¤–å¥—èˆ‡å†¬å­£é…ä»¶ï¼ˆTNF / Beamsï¼‰ï¼Œé¿å…ä¹‹å¾Œå¹¾å¤©ç‚ºäº†è²·è¡£æœåˆ†å¿ƒã€‚</p>
            </div>
            <div class="tags" id="day-tags">
              <span class="tag">WINTER GEAR</span>
              <span class="tag">NO RUSH</span>
            </div>
          </div>
        </div>
      </header>

      <main id="timeline" class="timeline"></main>

      <!-- Photo Break: guaranteed render (SVG data uri) -->
      <div class="photo-break">
        <div class="photo-wrapper" id="photo-wrapper">
          <img id="photo-img-element" class="photo-img-element" src="" alt="Day visual" />
        </div>
        <div class="photo-content">
          <div class="eyebrow">VIBE CHECK</div>
          <h3 id="photo-title">Title</h3>
          <p id="photo-desc">Description</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Bottom Navigation -->
  <nav class="bottom-nav">
    <div class="nav-scroll" id="nav-container"></div>
  </nav>

  <!-- Drawer (Trip Cheat Sheet) -->
  <div class="backdrop" id="backdrop"></div>
  <div class="drawer" id="drawer">
    <div class="drawer-header">
      <div class="drawer-title">æ—…ç¨‹å°æŠ„ Â· TRIP CHEAT SHEET</div>
      <button class="drawer-close" id="drawer-close" type="button">âœ•</button>
    </div>
    <div class="drawer-content">
      <div class="strategy-card">
        <h3>æ ¸å¿ƒåŸå‰‡ Â· CORE PRINCIPLES</h3>
        <p>æ…¢åŠæ‹ Ã— æœ‰ç­–ç•¥çš„åŸå¸‚æ—…è¡Œ</p>
        <ul class="strategy-list" style="padding-left: 20px; margin:0;">
          <li><strong>å†¬è£å…ˆæ±º</strong>ï¼šDay 1 æå®šä¿æš–ï¼Œå¾Œé¢åªé€›ä¸è²·é‡ç‰©ã€‚</li>
          <li><strong>ç¼ºè²¨é¢¨éšªç®¡ç†</strong>ï¼šDay 2 ä¸Šåˆå„ªå…ˆè™•ç†ç†±é–€å½©å¦ã€‚</li>
          <li><strong>å¥ˆè‰¯ç•™ç™½</strong>ï¼šDay 4 ä¸çœ‹åœ°åœ–ï¼Œåªçœ‹é¹¿èˆ‡æ¨¹ã€‚</li>
        </ul>
      </div>

      <div class="strategy-card">
        <h3>ä½å®¿ Â· HOTEL</h3>
        <p><strong>GRANBELL HOTEL OSAKA NAMBA</strong></p>
        <p style="font-size:0.85rem; color:var(--ink-muted);">
          å¤§é˜ªé›£æ³¢æ ¼è˜­è²çˆ¾é…’åº—<br>ã€’556-0011 å¤§é˜ªå¸‚æµªé€Ÿå€é›£æ³¢ä¸­2-6-7
        </p>
      </div>

      <div class="strategy-card">
        <h3>èˆªç­ Â· FLIGHTS (JL)</h3>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
          <div>
            <strong>å»ç¨‹ JL812</strong><br>
            <span style="font-size:0.8rem; color:var(--ink-muted);">08:20 TPE â†’ 11:50 KIX</span>
          </div>
          <div>
            <strong>å›ç¨‹ JL815</strong><br>
            <span style="font-size:0.8rem; color:var(--ink-muted);">19:20 KIX â†’ 21:35 TPE</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Detail Modal -->
  <div class="modal" id="modal">
    <h3 class="modal-h" id="modal-title">Title</h3>
    <div class="modal-sub" id="modal-sub">Subtitle</div>
    <div class="modal-body" id="modal-body">Content</div>
  </div>

  <script>
    /****************************************************************
     * v4 RESCUED: remove "AI generating" state machine completely.
     * Images are 100% local SVG Data URIs (photo-like).
     ****************************************************************/

    // --- PHOTO-LIKE SVG FACTORY (grain + bokeh + window grid + landmark silhouette) ---
    function svgPhotoDataURI(scene) {
      // scene: { key, titleColor, skyA, skyB, glowA, glowB, landmark, accent }
      const s = `
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1600 1000">
  <defs>
    <!-- background gradient -->
    <linearGradient id="sky" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0" stop-color="${scene.skyA}"/>
      <stop offset="0.65" stop-color="${scene.skyB}"/>
      <stop offset="1" stop-color="#1e1a16"/>
    </linearGradient>

    <!-- glow / sun haze -->
    <radialGradient id="glow" cx="35%" cy="25%" r="65%">
      <stop offset="0" stop-color="${scene.glowA}" stop-opacity="0.65"/>
      <stop offset="0.35" stop-color="${scene.glowB}" stop-opacity="0.25"/>
      <stop offset="1" stop-color="#000" stop-opacity="0"/>
    </radialGradient>

    <!-- grain -->
    <filter id="grain">
      <feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="3" stitchTiles="stitch" />
      <feColorMatrix type="matrix" values="
        1 0 0 0 0
        0 1 0 0 0
        0 0 1 0 0
        0 0 0 0.35 0" />
    </filter>

    <!-- cinematic blur for bokeh -->
    <filter id="bokehBlur" x="-20%" y="-20%" width="140%" height="140%">
      <feGaussianBlur stdDeviation="18"/>
    </filter>

    <!-- slight vignette -->
    <radialGradient id="vignette" cx="50%" cy="45%" r="70%">
      <stop offset="0" stop-color="#000" stop-opacity="0"/>
      <stop offset="0.7" stop-color="#000" stop-opacity="0.18"/>
      <stop offset="1" stop-color="#000" stop-opacity="0.42"/>
    </radialGradient>

    <!-- window grid -->
    <pattern id="grid" width="220" height="160" patternUnits="userSpaceOnUse">
      <path d="M220 0H0V160" fill="none" stroke="rgba(255,255,255,0.16)" stroke-width="2"/>
      <path d="M110 0V160" fill="none" stroke="rgba(255,255,255,0.10)" stroke-width="2"/>
      <path d="M0 80H220" fill="none" stroke="rgba(255,255,255,0.08)" stroke-width="2"/>
    </pattern>
  </defs>

  <!-- Base sky -->
  <rect width="1600" height="1000" fill="url(#sky)"/>

  <!-- Glow / haze -->
  <rect width="1600" height="1000" fill="url(#glow)"/>

  <!-- Bokeh lights -->
  <g filter="url(#bokehBlur)" opacity="0.45">
    <circle cx="230" cy="180" r="60" fill="rgba(255,230,180,0.9)"/>
    <circle cx="420" cy="260" r="40" fill="rgba(255,255,255,0.7)"/>
    <circle cx="1180" cy="210" r="70" fill="rgba(210,235,255,0.8)"/>
    <circle cx="1340" cy="340" r="55" fill="rgba(255,210,200,0.75)"/>
    <circle cx="980" cy="420" r="45" fill="rgba(255,245,220,0.55)"/>
    <circle cx="300" cy="520" r="55" fill="rgba(195,225,255,0.55)"/>
  </g>

  <!-- Landmark silhouette -->
  <g opacity="0.9">
    ${scene.landmark}
  </g>

  <!-- subtle fog band -->
  <rect y="600" width="1600" height="400" fill="rgba(255,255,255,0.06)"/>
  <rect y="680" width="1600" height="320" fill="rgba(0,0,0,0.10)"/>

  <!-- window grid overlay -->
  <rect width="1600" height="1000" fill="url(#grid)" opacity="0.55"/>

  <!-- accent highlight line -->
  <path d="M0 720 C 260 690, 520 760, 820 720 S 1320 700, 1600 740"
        fill="none" stroke="${scene.accent}" stroke-opacity="0.28" stroke-width="6"/>

  <!-- grain on top -->
  <rect width="1600" height="1000" filter="url(#grain)" opacity="0.42"/>

  <!-- vignette -->
  <rect width="1600" height="1000" fill="url(#vignette)"/>

  <!-- tiny title stamp (very subtle, like film) -->
  <text x="70" y="930" font-family="system-ui, sans-serif" font-size="34" fill="${scene.titleColor}" opacity="0.35" letter-spacing="4">
    ${scene.key}
  </text>
</svg>`.trim();

      return "data:image/svg+xml;charset=utf-8," + encodeURIComponent(s);
    }

    // --- 5 Day "Photo-like" Scenes (match daily theme) ---
    const DAY_VISUALS = [
      // Day 1: Rinku sunset + ferris wheel silhouette
      svgPhotoDataURI({
        key: "RINKU SUNSET",
        titleColor: "rgba(255,255,255,0.9)",
        skyA: "#f7c58a",
        skyB: "#6a84a6",
        glowA: "rgba(255,240,210,1)",
        glowB: "rgba(255,170,120,1)",
        accent: "rgba(255,240,210,1)",
        landmark: `
          <g fill="rgba(10,10,10,0.72)">
            <!-- horizon -->
            <rect x="0" y="700" width="1600" height="300" opacity="0.65"/>
            <!-- ferris wheel -->
            <circle cx="1240" cy="560" r="210" fill="none" stroke="rgba(0,0,0,0.75)" stroke-width="14"/>
            <circle cx="1240" cy="560" r="10" fill="rgba(0,0,0,0.85)"/>
            ${Array.from({length: 12}).map((_,i)=>{
              const a = (Math.PI*2*i)/12;
              const x = 1240 + Math.cos(a)*210;
              const y = 560 + Math.sin(a)*210;
              return `<line x1="1240" y1="560" x2="${x.toFixed(2)}" y2="${y.toFixed(2)}" stroke="rgba(0,0,0,0.6)" stroke-width="6"/>`;
            }).join("")}
            <!-- cabins -->
            ${Array.from({length: 10}).map((_,i)=>{
              const a = (Math.PI*2*i)/10 + 0.25;
              const x = 1240 + Math.cos(a)*210;
              const y = 560 + Math.sin(a)*210;
              return `<rect x="${(x-16).toFixed(2)}" y="${(y-12).toFixed(2)}" width="32" height="24" rx="6" fill="rgba(255,255,255,0.22)" stroke="rgba(0,0,0,0.55)" stroke-width="3"/>`;
            }).join("")}
            <!-- city blocks -->
            <rect x="0" y="650" width="520" height="180" opacity="0.55"/>
            <rect x="540" y="670" width="340" height="160" opacity="0.5"/>
            <rect x="900" y="690" width="220" height="140" opacity="0.48"/>
          </g>
        `
      }),

      // Day 2: Umeda / Kitahama river city + bridge lines
      svgPhotoDataURI({
        key: "RIVER CITY",
        titleColor: "rgba(255,255,255,0.9)",
        skyA: "#d9e3ef",
        skyB: "#7b8da3",
        glowA: "rgba(255,255,255,1)",
        glowB: "rgba(200,220,255,1)",
        accent: "rgba(190,220,255,1)",
        landmark: `
          <g fill="rgba(12,12,12,0.70)">
            <!-- water -->
            <rect x="0" y="720" width="1600" height="280" fill="rgba(0,0,0,0.55)"/>
            <path d="M0 740 C 260 700, 520 790, 820 740 S 1320 710, 1600 770" fill="rgba(255,255,255,0.06)"/>
            <!-- skyline -->
            <rect x="80" y="480" width="120" height="240" opacity="0.55"/>
            <rect x="220" y="430" width="150" height="290" opacity="0.58"/>
            <rect x="400" y="510" width="110" height="210" opacity="0.52"/>
            <rect x="540" y="390" width="180" height="330" opacity="0.62"/>
            <rect x="750" y="470" width="140" height="250" opacity="0.56"/>
            <rect x="920" y="420" width="220" height="300" opacity="0.60"/>
            <rect x="1160" y="500" width="170" height="220" opacity="0.54"/>
            <rect x="1350" y="450" width="160" height="270" opacity="0.57"/>
            <!-- bridge (Kitahama vibe) -->
            <path d="M240 700 Q 800 610 1360 700" fill="none" stroke="rgba(0,0,0,0.75)" stroke-width="18"/>
            <path d="M240 700 Q 800 640 1360 700" fill="none" stroke="rgba(255,255,255,0.18)" stroke-width="6"/>
            <!-- bridge rails -->
            ${Array.from({length: 18}).map((_,i)=>{
              const x = 260 + i*62;
              const y = 690 - Math.sin(i/3)*10;
              return `<rect x="${x}" y="${y}" width="10" height="40" fill="rgba(255,255,255,0.14)"/>`;
            }).join("")}
          </g>
        `
      }),

      // Day 3: Osaka Castle silhouette + trees
      svgPhotoDataURI({
        key: "OSAKA CASTLE",
        titleColor: "rgba(255,255,255,0.9)",
        skyA: "#dfe8ef",
        skyB: "#8897a7",
        glowA: "rgba(255,255,255,1)",
        glowB: "rgba(220,235,255,1)",
        accent: "rgba(255,255,255,1)",
        landmark: `
          <g fill="rgba(8,8,8,0.76)">
            <!-- ground -->
            <rect x="0" y="720" width="1600" height="280" opacity="0.62"/>
            <!-- trees -->
            ${Array.from({length: 26}).map((_,i)=>{
              const x = 30 + i*65;
              const h = 140 + (i%5)*18;
              return `
                <rect x="${x}" y="${720-h}" width="14" height="${h}" opacity="0.35"/>
                <circle cx="${x+7}" cy="${720-h}" r="${26 + (i%4)*6}" opacity="0.35"/>
              `;
            }).join("")}
            <!-- castle base -->
            <path d="M760 700 L 840 700 L 900 620 L 700 620 Z" opacity="0.70"/>
            <!-- main keep (stylized) -->
            <path d="M720 620 L 880 620 L 860 560 L 740 560 Z" opacity="0.85"/>
            <path d="M740 560 L 860 560 L 845 515 L 755 515 Z" opacity="0.88"/>
            <path d="M760 515 L 840 515 L 832 470 L 768 470 Z" opacity="0.92"/>
            <!-- roofs (white highlight) -->
            <path d="M705 620 L 895 620" stroke="rgba(255,255,255,0.22)" stroke-width="8"/>
            <path d="M728 560 L 872 560" stroke="rgba(255,255,255,0.20)" stroke-width="7"/>
            <path d="M748 515 L 852 515" stroke="rgba(255,255,255,0.18)" stroke-width="6"/>
            <!-- top -->
            <rect x="792" y="430" width="56" height="40" opacity="0.85"/>
            <path d="M780 430 L 860 430 L 850 410 L 790 410 Z" opacity="0.8"/>
          </g>
        `
      }),

      // Day 4: Nara deer silhouette + shrine lantern mood
      svgPhotoDataURI({
        key: "NARA QUIET",
        titleColor: "rgba(255,255,255,0.9)",
        skyA: "#d5c1ab",
        skyB: "#7a6b5f",
        glowA: "rgba(255,235,210,1)",
        glowB: "rgba(255,180,130,1)",
        accent: "rgba(255,210,170,1)",
        landmark: `
          <g fill="rgba(10,10,10,0.75)">
            <!-- forest ground -->
            <rect x="0" y="740" width="1600" height="260" opacity="0.65"/>
            <!-- tree trunks -->
            ${Array.from({length: 20}).map((_,i)=>{
              const x = 60 + i*78;
              const w = 18 + (i%3)*6;
              const top = 360 + (i%4)*30;
              return `<rect x="${x}" y="${top}" width="${w}" height="${740-top}" opacity="0.28"/>`;
            }).join("")}
            <!-- lanterns (Kasuga vibe) -->
            ${Array.from({length: 8}).map((_,i)=>{
              const x = 220 + i*170;
              const y = 560 + (i%2)*20;
              return `
                <rect x="${x}" y="${y}" width="20" height="90" opacity="0.35"/>
                <rect x="${x-20}" y="${y+20}" width="60" height="46" rx="8" fill="rgba(255,210,140,0.18)" stroke="rgba(255,210,140,0.28)" stroke-width="3"/>
              `;
            }).join("")}
            <!-- deer silhouette -->
            <path d="M980 740
                     C 940 730, 910 700, 920 670
                     C 930 635, 965 625, 990 640
                     C 1008 610, 1048 605, 1070 630
                     C 1105 640, 1130 665, 1120 700
                     C 1110 735, 1060 750, 980 740 Z"
                  opacity="0.80"/>
            <path d="M1000 640 C 1010 610, 1030 580, 1058 565
                     C 1080 555, 1090 535, 1100 510
                     C 1110 530, 1106 560, 1090 580
                     C 1072 602, 1048 615, 1020 622 Z"
                  opacity="0.82"/>
            <!-- antlers -->
            <path d="M1060 560
                     C 1040 520, 1020 500, 990 488
                     M1058 560
                     C 1075 525, 1100 510, 1130 505"
                  fill="none" stroke="rgba(0,0,0,0.78)" stroke-width="10" stroke-linecap="round"/>
            <!-- legs -->
            <rect x="955" y="732" width="16" height="80" opacity="0.55"/>
            <rect x="1005" y="736" width="16" height="90" opacity="0.55"/>
            <rect x="1060" y="734" width="16" height="86" opacity="0.55"/>
            <rect x="1100" y="730" width="16" height="82" opacity="0.55"/>
          </g>
        `
      }),

      // Day 5: Airport window + airplane silhouette
      svgPhotoDataURI({
        key: "KIX DEPARTURE",
        titleColor: "rgba(255,255,255,0.9)",
        skyA: "#b9c7ff",
        skyB: "#6b6f8a",
        glowA: "rgba(255,255,255,1)",
        glowB: "rgba(240,220,255,1)",
        accent: "rgba(230,230,255,1)",
        landmark: `
          <g fill="rgba(12,12,12,0.72)">
            <!-- runway -->
            <rect x="0" y="760" width="1600" height="240" opacity="0.64"/>
            <rect x="0" y="820" width="1600" height="14" fill="rgba(255,255,255,0.10)"/>
            ${Array.from({length: 18}).map((_,i)=>`<rect x="${i*95}" y="872" width="48" height="10" fill="rgba(255,255,255,0.14)"/>`).join("")}
            <!-- terminal blocks -->
            <rect x="120" y="610" width="420" height="150" opacity="0.38"/>
            <rect x="560" y="640" width="260" height="120" opacity="0.32"/>
            <!-- airplane silhouette -->
            <path d="M1080 380
                     C 1120 372, 1180 372, 1220 380
                     C 1245 385, 1275 396, 1292 410
                     C 1275 416, 1245 420, 1220 422
                     C 1180 426, 1120 426, 1080 422
                     C 1058 420, 1035 414, 1020 410
                     C 1035 396, 1058 385, 1080 380 Z"
                  opacity="0.85"/>
            <!-- wings -->
            <path d="M1140 402 L 920 470 L 936 498 L 1180 434 Z" opacity="0.75"/>
            <path d="M1160 404 L 1380 470 L 1360 500 L 1140 438 Z" opacity="0.75"/>
            <!-- tail -->
            <path d="M1220 382 L 1280 330 L 1305 340 L 1260 388 Z" opacity="0.78"/>
          </g>
        `
      })
    ];

    // --- DATA MODEL (yours, kept) ---
    const itinerary = [
      {
        id: 0,
        label: "DAY 01",
        date: "2025/12/15 Â· Mon",
        location: "KIX Â· Rinku Town",
        eyebrow: "DAY 01 Â· ARRIVAL",
        title: "Arrival & Winter Gear",
        subtitle: "æŠµé”èˆ‡å†¬è£è£œé½Šï¼šå¾å·¥ä½œæ¨¡å¼ç™»å‡ºï¼Œå°‡é‡é»æ”¾åœ¨ã€Œèª¿æ•´ç¯€å¥ã€ã€‚",
        strategy: "æ ¸å¿ƒä»»å‹™ï¼šåœ¨è‡¨ç©ºåŸä¸€æ¬¡è§£æ±ºä¿æš–å¤–å¥—ï¼ˆTNF / Patagoniaï¼‰èˆ‡é…ä»¶ï¼Œé¿å…å¾ŒçºŒè¡Œç¨‹ç‚ºäº†è²·è¡£æœè€Œä¸­æ–·ã€‚",
        tags: ["WINTER GEAR", "RINKU OUTLET", "SLOW START"],
        weatherCity: "Osaka",
        photo: {
          gradient: "radial-gradient(1200px 500px at 30% 20%, rgba(255,255,255,0.35), transparent 55%), linear-gradient(120deg, #f6d365 0%, #7aa0c6 70%, #2b2a2b 100%)",
          title: "è‡¨ç©ºåŸçš„æ—¥è½",
          desc: "æµ·é¢¨ç•¥å¸¶å¯’æ„ï¼Œæ‘©å¤©è¼ªä¸‹çš„å¤•é™½å®£å‘Šå‡æœŸæ­£å¼é–‹å§‹ã€‚"
        },
        timeline: [
          { time: "11:50", type: "ARRIVAL", title: "æŠµé”é—œè¥¿æ©Ÿå ´ (JL812)", location: "KIX T1", desc: "ä¸‹æ©Ÿå¾Œä¸æ€¥è‘—é€²å¸‚å€ã€‚å…ˆåœ¨æ©Ÿå ´æ„Ÿå—ä¸€ä¸‹æº«åº¦ï¼Œç¢ºèª ICOCA å¡èˆ‡ç¶²è·¯ç‹€æ…‹ã€‚" },
          { time: "13:30", type: "LUNCH", title: "Rinku Town åˆé¤", location: "Seaside Area", desc: "æ­ä¸€ç«™é›»è»Šåˆ° Rinku Townï¼Œåœ¨æµ·é‚Šé¤å»³ç°¡å–®ç”¨é¤ï¼Œçœ‹çœ‹æµ·ï¼Œè®“èº«é«”åˆ‡æ›æ™‚å€ã€‚" },
          { time: "15:00", type: "SHOPPING", title: "å†¬è£æˆ°ç•¥æ¡è³¼", location: "Rinku Premium Outlets",
            desc: "ç›®æ¨™æ˜ç¢ºï¼šä¿æš–å¤–å¥—ã€ç™¼ç†±è¡£ã€åœå·¾ã€‚<br>å„ªå…ˆé †åºï¼š<br>1. <strong>The North Face / Patagonia</strong> (ä¿æš–å±¤)<br>2. <strong>BEAMS / United Arrows</strong> (è³ªæ„Ÿå¤§è¡£)<br>3. <strong>Skechers / Nike</strong> (å¥½èµ°çš„é‹)",
            keywords: ["TNF", "BEAMS"]
          },
          { time: "18:30", type: "MOVE", title: "å‰å¾€é›£æ³¢é£¯åº—", location: "Granbell Hotel Namba", desc: "æ­ä¹˜å—æµ·é›»éµé€²å¸‚å€ï¼ŒCheck-in æ”¾ç½®æˆ°åˆ©å“ï¼Œå»ºç«‹é€™äº”å¤©çš„åŸºåœ°ã€‚" },
          { time: "20:00", type: "DINNER", title: "è‡ªç”±è»’ é›£æ³¢æœ¬åº—", location: "Namba", desc: "ç°¡å–®åƒä¸€ä»½åç‰©å’–å“©ï¼Œæ—©é»å›é£¯åº—ä¼‘æ¯ï¼Œæ•´ç†æ˜æ—¥æˆ°ç•¥ã€‚" }
        ]
      },
      {
        id: 1,
        label: "DAY 02",
        date: "2025/12/16 Â· Tue",
        location: "Umeda Â· Kitahama",
        eyebrow: "DAY 02 Â· CITY STRATEGY",
        title: "Strategic Shopping & City Vibe",
        subtitle: "å…ˆè§£æ±ºæ¸…å–®ï¼Œå†æ…¢æ…¢èµ°ï¼šä¸Šåˆè™•ç†ç¼ºè²¨é¢¨éšªé«˜çš„å“é …ï¼Œä¸‹åˆç•™çµ¦æ²³å²¸èˆ‡å’–å•¡ã€‚",
        strategy: "ä¸Šåˆç²¾ç¥æœ€å¥½æ™‚å»æ¢…ç”°è™•ç†å°ˆæ«ƒèˆ‡ç†±é–€å½©å¦ï¼ˆExcel/Canmakeï¼‰ï¼Œä¸‹åˆå‰‡å®Œå…¨æ”¾é¬†ï¼Œä¸èƒŒè³¼ç‰©è¢‹é€›è¡—ã€‚",
        tags: ["SCARCITY SHOPPING", "KITAHAMA CAFE", "RIVER WALK"],
        weatherCity: "Osaka",
        photo: {
          gradient: "radial-gradient(900px 450px at 30% 20%, rgba(255,255,255,0.35), transparent 60%), linear-gradient(135deg, #f5f7fa 0%, #9db0c7 55%, #2b2a2b 100%)",
          title: "åŒ—æ¿±çš„å¯§éœ",
          desc: "é›£æ³¢çš„å–§å›‚ä¹‹å¤–ï¼Œé€™è£¡æ˜¯å¤§é˜ªæœ€åƒæ­æ´²çš„è§’è½ã€‚"
        },
        timeline: [
          { time: "10:00", type: "SHOPPING", title: "æ¢…ç”°æˆ°ç•¥è³¼ç‰©", location: "LUCUA / Grand Front",
            desc: "é–å®šç¼ºè²¨é«˜é¢¨éšªå€ï¼š<br>â€¢ <strong>@cosme OSAKA</strong>: Excel (GB08), Canmake ç«æ¯›è†<br>â€¢ <strong>ç™¾è²¨å°ˆæ«ƒ</strong>: CPB / DIOR (è¶å…‰ç·šå¥½è©¦è‰²)<br>â€¢ <strong>3COINS</strong>: è¯åå•†å“çœ‹åˆ°å°±è²·",
            keywords: ["EXCEL", "CANMAKE", "CPB"]
          },
          { time: "13:30", type: "CHILL", title: "åŒ—æ¿±æ²³ç•”å’–å•¡", location: "Kitahama", desc: "è³¼ç‰©çµæŸï¼Œæ­è»Šåˆ°åŒ—æ¿±ã€‚é¸æ“‡ <strong>Gokan äº”æ„Ÿæœ¬é¤¨</strong> æˆ– <strong>&ISLAND</strong>ï¼Œçœ‹è‘—æ²³å·ç™¼å‘†ã€‚" },
          { time: "15:30", type: "WALK", title: "ä¸­å´ç”ºæ•£æ­¥", location: "Nakazakicho", desc: "åœ¨è€å±‹æ”¹å»ºçš„å°åº—é–“ç©¿æ¢­ã€‚é‡é»åº—å®¶ï¼š<strong>neel</strong> (å¯éº—é¤…)ã€<strong>OSA COFFEE</strong> (å¸ƒä¸)ã€‚åªçœ‹ä¸è²·ä¹Ÿç„¡æ‰€è¬‚ã€‚" },
          { time: "18:30", type: "DINNER", title: "é“é “å €ç¶“å…¸", location: "Dotonbori", desc: "å›åˆ°ç†±é¬§çš„é›£æ³¢ã€‚æ™šé¤é¸æ“‡ <strong>å‘³ä¹ƒå®¶ (å¤§é˜ªç‡’)</strong> æˆ–éš¨æ„è²· <strong>Kukuru ç« é­šç‡’</strong> å›é£¯åº—åƒã€‚" }
        ]
      },
      {
        id: 2,
        label: "DAY 03",
        date: "2025/12/17 Â· Wed",
        location: "Osaka Castle Park",
        eyebrow: "DAY 03 Â· SLOW DAY",
        title: "Castle Park & Winter Sun",
        subtitle: "æŠŠæ™‚é–“æ‹‰é•·ï¼šä¸æ€¥è‘—é€²å¤©å®ˆé–£ï¼Œé‡é»æ˜¯å…¬åœ’æœ¬èº«çš„æ¨¹å½±èˆ‡è­·åŸæ²³ã€‚",
        strategy: "ä»Šæ—¥æ˜¯é«”åŠ›èª¿ç¯€æ—¥ã€‚å¦‚æœæ˜¨å¤©é‚„æœ‰æœªè²·é½Šçš„é«˜å–®åƒ¹å“ï¼ˆCPB/DIORï¼‰ï¼Œä¸‹åˆå¯ä½œç‚ºå‚™æ¡ˆæ™‚é–“ã€‚",
        tags: ["OSAKA CASTLE", "JO-TERRACE", "RELAX"],
        weatherCity: "Osaka",
        photo: {
          gradient: "radial-gradient(900px 450px at 30% 15%, rgba(255,255,255,0.32), transparent 62%), linear-gradient(135deg, #cfd9df 0%, #9aa6b2 55%, #2b2a2b 100%)",
          title: "è­·åŸæ²³çš„å€’å½±",
          desc: "ä¸éœ€è¦çˆ¬ä¸Šå¤©å®ˆé–£ï¼Œå…‰æ˜¯æ²¿è‘—çŸ³ç‰†èµ°ï¼Œå°±èƒ½æ„Ÿå—åˆ°æ­·å²çš„é‡é‡ã€‚"
        },
        timeline: [
          { time: "10:00", type: "WALK", title: "å¤§é˜ªåŸå…¬åœ’æ•£æ­¥", location: "Osaka Castle Park", desc: "å¾æ£®ä¹‹å®®ç«™é€²å…¥ï¼Œæ²¿è‘—å¤–åœæ…¢æ…¢èµ°ã€‚ä¸ç”¨å¼·æ±‚ç™»ä¸Šå¤©å®ˆé–£ï¼Œæ‰¾å¼µé•·æ¤…æ›¬å†¬å¤©çš„å¤ªé™½ã€‚" },
          { time: "12:30", type: "LUNCH", title: "Jo-Terrace Osaka", location: "Osakajokoen Station", desc: "å…¬åœ’æ—çš„è¤‡åˆè¨­æ–½ï¼Œé¸æ“‡å¤šä¸”ç’°å¢ƒèˆ’é©ã€‚é¿é–‹éŠå®¢åœ˜é¤æ™‚æ®µã€‚" },
          { time: "15:00", type: "BUFFER", title: "å¸‚å€å‚™æ¡ˆ / ä¼‘æ¯", location: "City Center", desc: "å¦‚æœæ˜¨å¤©æ¢…ç”°æ²’è²·é½Šï¼Œé€™æ®µæ™‚é–“å¯å»å¿ƒé½‹æ©‹å¤§ä¸¸è£œè²¨ã€‚å¦‚æœç´¯äº†ï¼Œå°±å›é£¯åº—åˆç¡ã€‚" },
          { time: "18:30", type: "DINNER", title: "ç¦å¤ªéƒ å¤§é˜ªç‡’", location: "Namba", desc: "æœ¬åº—æ°›åœæ¥µä½³ï¼Œè”¥ç‡’æ˜¯å¿…é»ã€‚å¯èƒ½éœ€è¦æ’éšŠï¼Œå»ºè­°é¿é–‹å°–å³°æˆ–åšå¥½ç­‰å¾…å¿ƒç†æº–å‚™ã€‚" }
        ]
      },
      {
        id: 3,
        label: "DAY 04",
        date: "2025/12/18 Â· Thu",
        location: "Nara",
        eyebrow: "DAY 04 Â· NATURE",
        title: "Nara Day Trip",
        subtitle: "é¹¿èˆ‡æ¨¹çš„ä¸€å¤©ï¼šæŠŠè³¼ç‰©æ…¾æœ›é™åˆ°æœ€ä½ï¼Œåªå¸¶ç›¸æ©Ÿèˆ‡å¥½èµ°çš„å¿ƒæƒ…ã€‚",
        strategy: "å¥ˆè‰¯ä¸æ˜¯æ‰“å¡æ¸…å–®ï¼Œè€Œæ˜¯ä¸€å€‹è®“æ™‚é–“è®Šæ…¢çš„åœ°æ–¹ã€‚ä¸è³¼ç‰©ã€ä¸è¶•è·¯ï¼Œé †è‘—é¹¿çš„æ­¥èª¿èµ°ã€‚",
        tags: ["DEER", "OLD TOWN", "NO SHOPPING"],
        weatherCity: "Nara",
        photo: {
          gradient: "radial-gradient(900px 450px at 30% 18%, rgba(255,255,255,0.30), transparent 62%), linear-gradient(to top, #c79081 0%, #8a7a6c 55%, #2b2a2b 100%)",
          title: "å¤éƒ½çš„çœ¼ç¥",
          desc: "é€™è£¡çš„é¹¿æ¯”äººæ›´åƒä¸»äººã€‚è¨˜å¾—æŠŠé¤…ä¹¾è—å¥½ï¼Œä¿æŒå„ªé›…çš„è·é›¢ã€‚"
        },
        timeline: [
          { time: "09:30", type: "TRAIN", title: "å‰å¾€å¥ˆè‰¯", location: "Kintetsu Nara", desc: "æ­ä¹˜è¿‘éµå‰å¾€å¥ˆè‰¯ã€‚é€™æ®µè»Šç¨‹ç´„ 40 åˆ†é˜ï¼Œæ˜¯è½‰æ›å¿ƒæƒ…çš„éš§é“ã€‚" },
          { time: "10:30", type: "COFFEE", title: "Rokumei Coffee", location: "Nara", desc: "æŠµé”å¾Œå…ˆä¾†ä¸€æ¯å† è»å’–å•¡ã€‚Rokumei Coffee å¥ˆè‰¯æœ¬åº—ï¼Œå¸¶èµ°æˆ–å…§ç”¨éƒ½å¥½ã€‚" },
          { time: "12:00", type: "LUNCH", title: "å¿—æ´¥é¦™ é‡œé£¯", location: "Nara Park Area", desc: "è‘—åçš„é‡œé£¯ï¼Œç±³é£¯é¦™æ°£è¿·äººã€‚è‹¥æ’éšŠå¤ªé•·ï¼Œè½‰å¾€å¥ˆè‰¯ç”ºæ‰¾å®šé£Ÿä¹Ÿä¸éŒ¯ã€‚" },
          { time: "14:00", type: "WALK", title: "å¥ˆè‰¯å…¬åœ’ & è€è¡—", location: "Naramachi", desc: "é¿é–‹æ±å¤§å¯ºäººæ½®æœ€æ“æ“ è™•ï¼Œå¾€æ˜¥æ—¥å¤§ç¤¾åƒé“æˆ–å¥ˆè‰¯ç”ºè€è¡—èµ°ã€‚æ‰¾é–“å’Œè“å­åº—ååã€‚" },
          { time: "17:30", type: "RETURN", title: "è¿”å›å¤§é˜ª", location: "Namba", desc: "æ™šé¤éš¨æ„è§£æ±ºï¼Œæˆ–è¨±æ˜¯å¿ƒé½‹æ©‹çš„å¤©å©¦ç¾…ï¼Œæˆ–æ˜¯ç°¡å–®çš„æ‹‰éºµã€‚ä»Šæ™šæ—©é»ä¼‘æ¯ï¼Œæ•´ç†è¡Œæã€‚" }
        ]
      },
      {
        id: 4,
        label: "DAY 05",
        date: "2025/12/19 Â· Fri",
        location: "Namba Â· KIX",
        eyebrow: "DAY 05 Â· DEPARTURE",
        title: "Departure & Rituals",
        subtitle: "æŠŠæ—…ç¨‹æŠ˜æˆæ›¸ç±¤ï¼šæœ€å¾Œçš„å’–å•¡èˆ‡æœ€å¾Œçš„æ¡è²·ã€‚",
        strategy: "å›ç¨‹æ—¥çš„é‡é»æ˜¯ã€Œä¸éºæ¼ã€èˆ‡ã€Œå„€å¼æ„Ÿã€ã€‚æ©Ÿå ´ç•™çµ¦æœ€å¾Œä¸€æ¯å’–å•¡èˆ‡ä¼´æ‰‹ç¦®ã€‚",
        tags: ["AIRPORT", "LAST BUY", "GOODBYE"],
        weatherCity: "Osaka",
        photo: {
          gradient: "radial-gradient(900px 450px at 35% 20%, rgba(255,255,255,0.30), transparent 62%), linear-gradient(to top, #a18cd1 0%, #7d83a6 55%, #2b2a2b 100%)",
          title: "é›¢é–‹çš„è¦–è§’",
          desc: "é€éæ©Ÿå ´çš„ç»ç’ƒçª—ï¼Œå†çœ‹ä¸€æ¬¡é€™åº§åŸå¸‚çš„å¤©ç©ºã€‚ä¸‹æ¬¡å†ä¾†æ˜¯ä»€éº¼æ™‚å€™å‘¢ï¼Ÿ"
        },
        timeline: [
          { time: "10:00", type: "CHECKOUT", title: "é€€æˆ¿ & å¯„æ”¾è¡Œæ", location: "Granbell Hotel", desc: "11:00 é€€æˆ¿ã€‚å†æª¢æŸ¥ä¸€æ¬¡åºŠåº•èˆ‡æ’åº§ã€‚å»é™„è¿‘çš„è—¥å¦åº—è£œé½Šæœ€å¾Œçš„æ¶ˆè€—å“ï¼ˆéç¼ºè²¨é¡ï¼‰ã€‚" },
          { time: "12:00", type: "LUNCH", title: "æœ€å¾Œçš„å¤§é˜ªå‘³", location: "Namba", desc: "é¸æ“‡ä¸€å®¶é‚„æ²’åƒåˆ°çš„æ¸…å–®ï¼Œæˆ–è€…å–®ç´”åƒå€‹å¾¡é£¯ç³°ï¼ŒæŠŠèƒƒç•™çµ¦é£›æ©Ÿé¤æˆ–æ©Ÿå ´ç¾é£Ÿã€‚" },
          { time: "14:30", type: "MOVE", title: "å‰å¾€é—œè¥¿æ©Ÿå ´", location: "Nankai Line", desc: "æ­ä¹˜ Rapi:t æˆ–ç©ºæ¸¯æ€¥è¡Œå‰å¾€ KIXã€‚é ç•™å……è£•æ™‚é–“ã€‚" },
          { time: "16:00", type: "LAST STOP", title: "æ©Ÿå ´å„€å¼", location: "KIX Airside", desc: "1. æœ€å¾Œä¸€æ¯å’–å•¡ã€‚<br>2. è³¼è²·é—œè¥¿é™å®šä¼´æ‰‹ç¦®ï¼ˆè³å‘³æœŸé™çŸ­çš„é»å¿ƒï¼‰ã€‚<br>3. æº–å‚™ç™»æ©Ÿ JL815 (19:20)ã€‚" }
        ]
      }
    ];

    const modalDetails = {
      "TNF": "Rinku Outlet çš„åŒ—é¢å¸¸è¦‹å°ºç¢¼èˆ‡æ¬¾å¼æ›´é½Šã€‚é‡é»çœ‹å¤–å±¤é˜²é¢¨é˜²æ°´ï¼‹ä¸­å±¤ä¿æš–çš„çµ„åˆï¼Œä¸è¦åªè²·å¥½çœ‹ã€‚",
      "BEAMS": "Outlet çš„ BEAMS å¾ˆå¤šé«˜å“è³ªåŸºæœ¬æ¬¾ï¼ˆç¾Šæ¯›ã€æ··ç´¡å¤–å¥—ï¼‰ï¼ŒCP å€¼é«˜ã€‚çœ‹ç‰ˆå‹ã€çœ‹è³ªæ–™ã€çœ‹ä½ èƒ½ä¸èƒ½é€£ç©¿ä¸‰å¤©ã€‚",
      "EXCEL": "Excel (GB08 ç­‰ç†±é–€è‰²) åœ¨è§€å…‰å€å®¹æ˜“ç¼ºã€‚æ¢…ç”°ä¸€å¸¶è£œè²¨æ•ˆç‡é«˜ï¼šå…ˆè²·ç¼ºè²¨é«˜é¢¨éšªå“ï¼Œå†æ…¢æ…¢æ•£æ­¥ã€‚",
      "CANMAKE": "ç†±é–€ç«æ¯›/è…®ç´…æ–°è‰²å¸¸ç¼ºã€‚åŸå‰‡ï¼šçœ‹åˆ°å°±è²·ï¼Œåˆ¥è³­æ™šé»é‚„æœ‰ã€‚",
      "CPB": "ç™¾è²¨å°ˆæ«ƒè³¼è²·å¯é€€ç¨…ã€‚å»ºè­°äº‹å…ˆå­˜å¥½è‰²è™Ÿåƒè€ƒåœ–ï¼Œç›´æ¥çµ¦æ«ƒå§çœ‹ï¼Œçœæ‰åè¦†è©¦è‰²çš„æ™‚é–“ã€‚"
    };

    const state = {
      activeDay: 0,
      weather: {}
    };

    const els = {
      timeline: document.getElementById('timeline'),
      nav: document.getElementById('nav-container'),
      drawer: document.getElementById('drawer'),
      backdrop: document.getElementById('backdrop'),
      modal: document.getElementById('modal'),

      date: document.getElementById('day-date'),
      location: document.getElementById('day-location'),
      title: document.getElementById('day-title'),
      subtitle: document.getElementById('day-subtitle'),
      strategy: document.getElementById('day-strategy'),
      tags: document.getElementById('day-tags'),
      weather: document.getElementById('weather-display'),
      eyebrow: document.getElementById('day-eyebrow'),

      photoWrapper: document.getElementById('photo-wrapper'),
      photoImgElement: document.getElementById('photo-img-element'),
      photoTitle: document.getElementById('photo-title'),
      photoDesc: document.getElementById('photo-desc'),

      editToggle: document.getElementById('edit-toggle'),
      closeDrawer: document.getElementById('drawer-close')
    };

    function init() {
      renderNav();
      loadDay(0);
      fetchWeather(itinerary[0].weatherCity);

      els.editToggle.addEventListener('click', toggleEdit);
      els.backdrop.addEventListener('click', closeAllOverlays);
      els.closeDrawer.addEventListener('click', closeAllOverlays);

      document.addEventListener('click', (e) => {
        if (e.target.classList && e.target.classList.contains('keyword-link')) {
          openModal(e.target.innerText, e.target.dataset.key);
        }
      });
    }

    function renderNav() {
      const frag = document.createDocumentFragment();

      itinerary.forEach((day, idx) => {
        const btn = document.createElement('button');
        btn.className = `nav-btn ${idx === 0 ? 'active' : ''}`;
        btn.innerHTML = `<span class="nav-btn-dot"></span><span>${day.label}</span>`;
        btn.onclick = () => loadDay(idx);
        frag.appendChild(btn);
      });

      const tripBtn = document.createElement('button');
      tripBtn.className = 'nav-btn special';
      tripBtn.innerHTML = `<span>TRIP</span>`;
      tripBtn.onclick = openDrawer;
      frag.appendChild(tripBtn);

      els.nav.innerHTML = '';
      els.nav.appendChild(frag);
    }

    function loadDay(idx) {
      state.activeDay = idx;
      const data = itinerary[idx];

      // Update nav active state
      document.querySelectorAll('.nav-btn').forEach((b, i) => {
        if (i < itinerary.length) b.classList.toggle('active', i === idx);
      });

      // Hero swap (fade)
      fadeSwap(els.title, data.title);
      fadeSwap(els.subtitle, data.subtitle);
      els.date.innerText = data.date;
      els.location.innerText = data.location;
      els.eyebrow.innerText = data.eyebrow;
      els.strategy.innerHTML = data.strategy;

      els.tags.innerHTML = data.tags.map(t => `<span class="tag">${t}</span>`).join('');

      // Photo: guaranteed rendering (no placeholder, no "AI generating")
      els.photoWrapper.style.background = data.photo.gradient;
      els.photoTitle.innerText = data.photo.title;
      els.photoDesc.innerText = data.photo.desc;

      // Set SVG data uri
      const svgURI = DAY_VISUALS[idx];
      els.photoImgElement.src = svgURI;

      // If anything goes wrong, we still keep gradient background; do NOT show any placeholder text.
      els.photoImgElement.onerror = () => {
        els.photoImgElement.removeAttribute('src');
      };

      renderTimeline(data.timeline);

      // Weather mock
      const prevCity = itinerary[idx > 0 ? idx - 1 : 0].weatherCity;
      if (data.weatherCity !== prevCity || idx === 0) fetchWeather(data.weatherCity);

      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function renderTimeline(items) {
      els.timeline.innerHTML = items.map((item) => {
        let desc = item.desc;

        if (item.keywords) {
          item.keywords.forEach(kw => {
            if (modalDetails[kw]) {
              // Replace keyword occurrences with clickable span
              const safe = kw.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
              desc = desc.replace(new RegExp(safe, 'g'), `<span class="keyword-link" data-key="${kw}">${kw}</span>`);
            }
          });
        }

        const mapQuery = encodeURIComponent(item.location + ' Osaka');
        return `
          <div class="timeline-item">
            <div class="timeline-time">
              ${item.time}
              <div class="timeline-dot"></div>
              <div class="timeline-line"></div>
            </div>
            <article class="timeline-card">
              <div class="timeline-header">
                <div class="timeline-title" contenteditable="false">${item.title}</div>
                <div class="timeline-type">${item.type}</div>
              </div>
              <div class="timeline-location">
                ğŸ“ <a href="https://www.google.com/maps/search/?api=1&query=${mapQuery}" target="_blank" rel="noopener noreferrer">${item.location}</a>
              </div>
              <div class="timeline-body" contenteditable="false">${desc}</div>
            </article>
          </div>
        `;
      }).join('');
    }

    function fadeSwap(el, html) {
      el.style.opacity = 0;
      setTimeout(() => {
        el.innerHTML = html;
        el.style.opacity = 1;
      }, 140);
    }

    function openDrawer() {
      els.backdrop.classList.add('active');
      els.drawer.classList.add('active');
    }

    function closeAllOverlays() {
      els.backdrop.classList.remove('active');
      els.drawer.classList.remove('active');
      els.modal.classList.remove('active');
    }

    function openModal(title, key) {
      const content = modalDetails[key] || "æš«ç„¡è©³ç´°ç­–ç•¥è³‡è¨Šã€‚";
      document.getElementById('modal-title').innerText = title;
      document.getElementById('modal-sub').innerText = "SHOPPING STRATEGY";
      document.getElementById('modal-body').innerText = content;

      els.backdrop.classList.add('active');
      els.modal.classList.add('active');
    }

    function toggleEdit() {
      const isEditable = els.editToggle.classList.toggle('active');
      // Editable parts: timeline title & body only
      document.querySelectorAll('.timeline-title, .timeline-body').forEach(el => {
        el.setAttribute('contenteditable', isEditable ? 'true' : 'false');
      });
      els.editToggle.innerText = isEditable ? 'âœ“ SAVE' : 'âœ EDIT';
    }

    async function fetchWeather(city) {
      els.weather.innerText = "Loading...";
      try {
        setTimeout(() => {
          const temps = { "Osaka": "8Â°C", "Nara": "6Â°C" };
          els.weather.innerText = temps[city] || "10Â°C";
        }, 420);
      } catch (e) {
        els.weather.innerText = "--";
      }
    }

    init();
  </script>
</body>
</html>
